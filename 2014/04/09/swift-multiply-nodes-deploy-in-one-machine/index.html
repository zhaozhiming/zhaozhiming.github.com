<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>swift单节点多dev环境部署 - Hacker and Geeker&#39;s Way</title>
    <meta name="author" content="">
    
	<meta name="description" content="&lt;h2 id=&#34;环境目标&#34;&gt;&lt;a href=&#34;#环境目标&#34; class=&#34;headerlink&#34; title=&#34;环境目标&#34;&gt;&lt;/a&gt;环境目标&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;同一台机器&lt;/li&gt;
&lt;li&gt;1台proxy server&lt;/li&gt;
&lt;li&gt;5个storage node&lt;/li&gt;
&lt;li&gt;每个storage node有2个dev&lt;/li&gt;
&lt;/ul&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;  

&lt;p&gt;安装过程可以按照&lt;a href=&#34;http://docs.openstack.org/developer/swift/development_saio.html&#34;&gt;swift all in one&lt;/a&gt;文档进行搭建，在操作过程中需要修改以下的地方。 &lt;/p&gt;
&lt;h2 id=&#34;Using-a-loopback-device-for-storage&#34;&gt;&lt;a href=&#34;#Using-a-loopback-device-for-storage&#34; class=&#34;headerlink&#34; title=&#34;Using a loopback device for storage&#34;&gt;&lt;/a&gt;Using a loopback device for storage&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Create the file for the loopback device:&lt;br&gt;&lt;code&gt;(这里的标题和编号是与saio的保持一致，这样方便大家按照saio的编号进行修改，后面的步骤与此相同，不再做说明)&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;修改前：  &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;truncate&lt;/span&gt; -s 1GB /srv/swift-disk&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt; 
&lt;p&gt;修改后：  &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;truncate&lt;/span&gt; -s 500GB /srv/swift-disk&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;将xfs文件系统的大小改为500GB，原来的1GB太小不适合做测试。  &lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Create the mount point and the individualized links:&lt;br&gt;将原来的脚本修改为：  &lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;mkdir&lt;/span&gt; /mnt/sdb1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; mount /mnt/sdb1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;mkdir&lt;/span&gt; /mnt/sdb1/1 /mnt/sdb1/2 /mnt/sdb1/3 /mnt/sdb1/4 /mnt/sdb1/5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;chown&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$&amp;#123;USER&amp;#125;&lt;/span&gt;:&lt;span class=&#34;variable&#34;&gt;$&amp;#123;USER&amp;#125;&lt;/span&gt; /mnt/sdb1/*&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; x &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; &amp;#123;1..5&amp;#125;; &lt;span class=&#34;keyword&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;ln&lt;/span&gt; -s /mnt/sdb1/&lt;span class=&#34;variable&#34;&gt;$x&lt;/span&gt; /srv/&lt;span class=&#34;variable&#34;&gt;$x&lt;/span&gt;; &lt;span class=&#34;keyword&#34;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;mkdir&lt;/span&gt; -p /srv/1/node/dev1 /srv/1/node/dev2 /srv/2/node/dev3 /srv/2/node/dev4 /srv/3/node/dev5 /srv/3/node/dev6 /srv/4/node/dev7 /srv/4/node/dev8 /srv/5/node/dev9 /srv/5/node/dev10 /var/run/swift&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;chown&lt;/span&gt; -R &lt;span class=&#34;variable&#34;&gt;$&amp;#123;USER&amp;#125;&lt;/span&gt;:&lt;span class=&#34;variable&#34;&gt;$&amp;#123;USER&amp;#125;&lt;/span&gt; /var/run/swift&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# **Make sure to include the trailing slash after /srv/$x/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; x &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; &amp;#123;1..5&amp;#125;; &lt;span class=&#34;keyword&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;chown&lt;/span&gt; -R &lt;span class=&#34;variable&#34;&gt;$&amp;#123;USER&amp;#125;&lt;/span&gt;:&lt;span class=&#34;variable&#34;&gt;$&amp;#123;USER&amp;#125;&lt;/span&gt; /srv/&lt;span class=&#34;variable&#34;&gt;$x&lt;/span&gt;/; &lt;span class=&#34;keyword&#34;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;创建属于5个节点的文件夹，在每个节点文件夹下创建2个dev文件夹，表示1个节点有2个dev，其中region1有6台dev(1&lt;del&gt;6)，region2有4台dev(7&lt;/del&gt;10)。  &lt;/p&gt;
&lt;h2 id=&#34;Common-Post-Device-Setup&#34;&gt;&lt;a href=&#34;#Common-Post-Device-Setup&#34; class=&#34;headerlink&#34; title=&#34;Common Post-Device Setup&#34;&gt;&lt;/a&gt;Common Post-Device Setup&lt;/h2&gt;&lt;p&gt;Add the following lines to &amp;#x2F;etc&amp;#x2F;rc.local (before the exit 0):&lt;br&gt;修改前：  &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;mkdir&lt;/span&gt; -p /var/cache/swift /var/cache/swift2 /var/cache/swift3 /var/cache/swift4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt; 
&lt;p&gt;修改后：  &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;mkdir&lt;/span&gt; -p /var/cache/swift /var/cache/swift2 /var/cache/swift3 /var/cache/swift4 /var/cache/swift5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;因为有5个节点，所以增加了1个新节点的缓存文件夹。  &lt;/p&gt;
&lt;h2 id=&#34;Setting-up-rsync&#34;&gt;&lt;a href=&#34;#Setting-up-rsync&#34; class=&#34;headerlink&#34; title=&#34;Setting up rsync&#34;&gt;&lt;/a&gt;Setting up rsync&lt;/h2&gt;&lt;p&gt;Here is the default rsyncd.conf file contents maintained in the repo that is copied and fixed up above:  &lt;/p&gt;
&lt;p&gt;在&amp;#x2F;etc&amp;#x2F;rsyncd.conf文件追加以下内容：  &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[account6052]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;max connections = 25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;path = /srv/5/node/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;read&lt;/span&gt; only = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;lock file = /var/lock/account6052.lock&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[container6051]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;max connections = 25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;path = /srv/5/node/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;read&lt;/span&gt; only = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;lock file = /var/lock/container6051.lock&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[object6050]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;max connections = 25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;path = /srv/5/node/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;read&lt;/span&gt; only = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;lock file = /var/lock/object6050.lock&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;增加了新节点的account, container, object服务的同步配置。  &lt;/p&gt;
&lt;p&gt;You should see the following output from the above command: &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;account6012&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;account6022&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;account6032&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;account6042&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;account6052&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;container6011&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;container6021&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;container6031&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;container6041&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;container6051&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;object6010&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;object6020&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;object6030&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;object6040&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;object6050&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;验证rsync可以看到新增的account, container, object信息。  &lt;/p&gt;
&lt;h2 id=&#34;Optional-Setting-up-rsyslog-for-individual-logging&#34;&gt;&lt;a href=&#34;#Optional-Setting-up-rsyslog-for-individual-logging&#34; class=&#34;headerlink&#34; title=&#34;Optional: Setting up rsyslog for individual logging&#34;&gt;&lt;/a&gt;Optional: Setting up rsyslog for individual logging&lt;/h2&gt;&lt;p&gt;将&amp;#x2F;etc&amp;#x2F;rsyslog.d&amp;#x2F;10-swift.conf文件内容修改为：  &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# Uncomment the following to have a log containing all logs together&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#local1,local2,local3,local4,local5.*   /var/log/swift/all.log&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# Uncomment the following to have hourly proxy logs for stats processing&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#$template HourlyProxyLog,&amp;quot;/var/log/swift/hourly/%$YEAR%%$MONTH%%$DAY%%$HOUR%&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#local1.*;local1.!notice ?HourlyProxyLog&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local1.*;local1.!notice /var/log/swift/proxy.log&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local1.notice           /var/log/swift/proxy.error&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local1.*                ~ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local2.*;local2.!notice /var/log/swift/storage1.&lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local2.notice           /var/log/swift/storage1.error&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local2.*                ~&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local3.*;local3.!notice /var/log/swift/storage2.&lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local3.notice           /var/log/swift/storage2.error&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local3.*                ~&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local4.*;local4.!notice /var/log/swift/storage3.&lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local4.notice           /var/log/swift/storage3.error&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local4.*                ~&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local5.*;local5.!notice /var/log/swift/storage4.&lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local5.notice           /var/log/swift/storage4.error&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local5.*                ~&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local6.*;local6.!notice /var/log/swift/storage5.&lt;span class=&#34;built_in&#34;&gt;log&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local6.notice           /var/log/swift/storage5.error&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local6.*                ~&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local7.*;local7.!notice /var/log/swift/expirer.log&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local7.notice           /var/log/swift/expirer.error&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;local7.*                ~&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;修改日志配置，将原来的local6指向storage node 5, 原来的expirer用local7来记录日志（&lt;code&gt;注意：后面在修改各个节点的服务配置文件时需要知道这些日志配置信息&lt;/code&gt;）。 &lt;/p&gt;
&lt;h2 id=&#34;Configuring-each-node&#34;&gt;&lt;a href=&#34;#Configuring-each-node&#34; class=&#34;headerlink&#34; title=&#34;Configuring each node&#34;&gt;&lt;/a&gt;Configuring each node&lt;/h2&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&amp;#x2F;etc&amp;#x2F;swift&amp;#x2F;object-expirer.conf&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;修改前：  &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;log_facility = LOG_LOCAL6     &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;修改后：  &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;log_facility = LOG_LOCAL7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;新增account5的配置文件 &amp;#x2F;etc&amp;#x2F;swift&amp;#x2F;account-server&amp;#x2F;5.conf：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[DEFAULT]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;devices = /srv/5/node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mount_check = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;disable_fallocate = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bind_port = 6052&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;workers = 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user = swift&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;log_facility = LOG_LOCAL6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;recon_cache_path = /var/cache/swift5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;eventlet_debug = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[pipeline:main]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pipeline = recon account-server&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[app:account-server]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;use = egg:swift#account&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[filter:recon]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;use = egg:swift#recon&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[account-replicator]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vm_test_mode = &lt;span class=&#34;built_in&#34;&gt;yes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[account-auditor]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[account-reaper]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;新增container5的配置文件&amp;#x2F;etc&amp;#x2F;swift&amp;#x2F;container-server&amp;#x2F;5.conf：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[DEFAULT]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;devices = /srv/5/node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mount_check = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;disable_fallocate = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bind_port = 6051&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;workers = 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user = swift&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;log_facility = LOG_LOCAL6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;recon_cache_path = /var/cache/swift5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;eventlet_debug = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;allow_versions = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[pipeline:main]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pipeline = recon container-server&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[app:container-server]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;use = egg:swift#container&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[filter:recon]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;use = egg:swift#recon&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[container-replicator]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vm_test_mode = &lt;span class=&#34;built_in&#34;&gt;yes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[container-updater]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[container-auditor]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[container-sync]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;新增object5的配置文件&amp;#x2F;etc&amp;#x2F;swift&amp;#x2F;object-server&amp;#x2F;5.conf：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[DEFAULT]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;devices = /srv/5/node&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mount_check = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;disable_fallocate = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bind_port = 6050&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;workers = 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user = swift&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;log_facility = LOG_LOCAL6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;recon_cache_path = /var/cache/swift5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;eventlet_debug = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[pipeline:main]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pipeline = recon object-server&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[app:object-server]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;use = egg:swift#object&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[filter:recon]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;use = egg:swift#recon&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[object-replicator]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vm_test_mode = &lt;span class=&#34;built_in&#34;&gt;yes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[object-updater]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[object-auditor]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;Setting-up-scripts-for-running-Swift&#34;&gt;&lt;a href=&#34;#Setting-up-scripts-for-running-Swift&#34; class=&#34;headerlink&#34; title=&#34;Setting up scripts for running Swift&#34;&gt;&lt;/a&gt;Setting up scripts for running Swift&lt;/h2&gt;&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;Construct the initial rings using the provided script:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;先修改bin&amp;#x2F;remakerings文件，在执行remakerings命令：  &lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;cd&lt;/span&gt; /etc/swift&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;rm&lt;/span&gt; -f *.builder *.ring.gz backups/*.builder backups/*.ring.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder create 19 6 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder add r1z1-127.0.0.1:6010/dev1 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder add r1z1-127.0.0.1:6010/dev2 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder add r1z2-127.0.0.1:6020/dev3 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder add r1z2-127.0.0.1:6020/dev4 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder add r1z3-127.0.0.1:6030/dev5 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder add r1z3-127.0.0.1:6030/dev6 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder add r2z1-127.0.0.1:6040/dev7 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder add r2z1-127.0.0.1:6040/dev8 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder add r2z2-127.0.0.1:6050/dev9 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder add r2z2-127.0.0.1:6050/dev10 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder object.builder rebalance&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder create 19 6 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder add r1z1-127.0.0.1:6011/dev1 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder add r1z1-127.0.0.1:6011/dev2 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder add r1z2-127.0.0.1:6021/dev3 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder add r1z2-127.0.0.1:6021/dev4 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder add r1z3-127.0.0.1:6031/dev5 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder add r1z3-127.0.0.1:6031/dev6 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder add r2z1-127.0.0.1:6041/dev7 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder add r2z1-127.0.0.1:6041/dev8 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder add r2z2-127.0.0.1:6051/dev9 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder add r2z2-127.0.0.1:6051/dev10 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder container.builder rebalance&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder create 19 6 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder add r1z1-127.0.0.1:6012/dev1 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder add r1z1-127.0.0.1:6012/dev2 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder add r1z2-127.0.0.1:6022/dev3 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder add r1z2-127.0.0.1:6022/dev4 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder add r1z3-127.0.0.1:6032/dev5 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder add r1z3-127.0.0.1:6032/dev6 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder add r2z1-127.0.0.1:6042/dev7 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder add r2z1-127.0.0.1:6042/dev8 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder add r2z2-127.0.0.1:6052/dev9 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder add r2z2-127.0.0.1:6052/dev10 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;swift-ring-builder account.builder rebalance&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;新ring环有2的19次方，6个副本，修改后重新生成ring环即可。&lt;/p&gt;
"> <!-- TODO: truncate -->
	<meta name="keywords" content="swift">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="Hacker and Geeker&#39;s Way" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='/stylesheets/font.css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Amethysta+One' rel='stylesheet' type='text/css'>
	  <script src="/javascripts/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-100485541-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Hacker and Geeker&#39;s Way
    </div>
</h1>
<span class="subtitle"></span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a target="_blank" rel="noopener" href="https://github.com/zhaozhiming" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.twitter.com/kingzzm" class="twitter" title="Twitter"></a>
  </li>
  
  
  <!-- LinkedIn -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.linkedin.com/in/zhaozhiming" class="linkedin" title="LinkedIn"></a>
  </li>
  
  
  
  
  
  <!-- Stackoverflow -->
  <li>
  <a target="_blank" rel="noopener" href="http://stackoverflow.com/users/1954315/zhaozhiming" class="stackoverflow" title="Stackoverflow"></a>
  </li>
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li><a href="/about/index.html">About</a></li>
    
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="https://zhaozhiming.github.io" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>


<div id="toload">
<!-- begin toload -->
    <div id="content">
        <div class="inner">
<article class="post">
	<h2 class="title">swift单节点多dev环境部署</h2>
    <div class="meta">
        <div class="date">Published on: <time datetime="2014-04-09T12:45:00.000Z" itemprop="datePublished">4月 9, 2014</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/swift/">swift</a>
</div>
    </div>
	<div class="entry-content"><h2 id="环境目标"><a href="#环境目标" class="headerlink" title="环境目标"></a>环境目标</h2><ul>
<li>同一台机器</li>
<li>1台proxy server</li>
<li>5个storage node</li>
<li>每个storage node有2个dev</li>
</ul>
<span id="more"></span>  

<p>安装过程可以按照<a target="_blank" rel="noopener" href="http://docs.openstack.org/developer/swift/development_saio.html">swift all in one</a>文档进行搭建，在操作过程中需要修改以下的地方。 </p>
<h2 id="Using-a-loopback-device-for-storage"><a href="#Using-a-loopback-device-for-storage" class="headerlink" title="Using a loopback device for storage"></a>Using a loopback device for storage</h2><ol>
<li>Create the file for the loopback device:<br><code>(这里的标题和编号是与saio的保持一致，这样方便大家按照saio的编号进行修改，后面的步骤与此相同，不再做说明)</code></li>
</ol>
<p>修改前：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">truncate</span> -s 1GB /srv/swift-disk</span><br></pre></td></tr></table></figure> 
<p>修改后：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">truncate</span> -s 500GB /srv/swift-disk</span><br></pre></td></tr></table></figure>
<p>将xfs文件系统的大小改为500GB，原来的1GB太小不适合做测试。  </p>
<ol start="3">
<li>Create the mount point and the individualized links:<br>将原来的脚本修改为：  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> /mnt/sdb1</span><br><span class="line"><span class="built_in">sudo</span> mount /mnt/sdb1</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> /mnt/sdb1/1 /mnt/sdb1/2 /mnt/sdb1/3 /mnt/sdb1/4 /mnt/sdb1/5</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> <span class="variable">$&#123;USER&#125;</span>:<span class="variable">$&#123;USER&#125;</span> /mnt/sdb1/*</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> &#123;1..5&#125;; <span class="keyword">do</span> <span class="built_in">sudo</span> <span class="built_in">ln</span> -s /mnt/sdb1/<span class="variable">$x</span> /srv/<span class="variable">$x</span>; <span class="keyword">done</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /srv/1/node/dev1 /srv/1/node/dev2 /srv/2/node/dev3 /srv/2/node/dev4 /srv/3/node/dev5 /srv/3/node/dev6 /srv/4/node/dev7 /srv/4/node/dev8 /srv/5/node/dev9 /srv/5/node/dev10 /var/run/swift</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> -R <span class="variable">$&#123;USER&#125;</span>:<span class="variable">$&#123;USER&#125;</span> /var/run/swift</span><br><span class="line"><span class="comment"># **Make sure to include the trailing slash after /srv/$x/**</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> &#123;1..5&#125;; <span class="keyword">do</span> <span class="built_in">sudo</span> <span class="built_in">chown</span> -R <span class="variable">$&#123;USER&#125;</span>:<span class="variable">$&#123;USER&#125;</span> /srv/<span class="variable">$x</span>/; <span class="keyword">done</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>创建属于5个节点的文件夹，在每个节点文件夹下创建2个dev文件夹，表示1个节点有2个dev，其中region1有6台dev(1<del>6)，region2有4台dev(7</del>10)。  </p>
<h2 id="Common-Post-Device-Setup"><a href="#Common-Post-Device-Setup" class="headerlink" title="Common Post-Device Setup"></a>Common Post-Device Setup</h2><p>Add the following lines to &#x2F;etc&#x2F;rc.local (before the exit 0):<br>修改前：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /var/cache/swift /var/cache/swift2 /var/cache/swift3 /var/cache/swift4</span><br></pre></td></tr></table></figure> 
<p>修改后：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /var/cache/swift /var/cache/swift2 /var/cache/swift3 /var/cache/swift4 /var/cache/swift5</span><br></pre></td></tr></table></figure>
<p>因为有5个节点，所以增加了1个新节点的缓存文件夹。  </p>
<h2 id="Setting-up-rsync"><a href="#Setting-up-rsync" class="headerlink" title="Setting up rsync"></a>Setting up rsync</h2><p>Here is the default rsyncd.conf file contents maintained in the repo that is copied and fixed up above:  </p>
<p>在&#x2F;etc&#x2F;rsyncd.conf文件追加以下内容：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[account6052]</span><br><span class="line">max connections = 25</span><br><span class="line">path = /srv/5/node/</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line">lock file = /var/lock/account6052.lock</span><br><span class="line"></span><br><span class="line">[container6051]</span><br><span class="line">max connections = 25</span><br><span class="line">path = /srv/5/node/</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line">lock file = /var/lock/container6051.lock</span><br><span class="line"></span><br><span class="line">[object6050]</span><br><span class="line">max connections = 25</span><br><span class="line">path = /srv/5/node/</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line">lock file = /var/lock/object6050.lock</span><br></pre></td></tr></table></figure>
<p>增加了新节点的account, container, object服务的同步配置。  </p>
<p>You should see the following output from the above command: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">account6012</span><br><span class="line">account6022</span><br><span class="line">account6032</span><br><span class="line">account6042</span><br><span class="line">account6052</span><br><span class="line">container6011</span><br><span class="line">container6021</span><br><span class="line">container6031</span><br><span class="line">container6041</span><br><span class="line">container6051</span><br><span class="line">object6010</span><br><span class="line">object6020</span><br><span class="line">object6030</span><br><span class="line">object6040</span><br><span class="line">object6050</span><br></pre></td></tr></table></figure>
<p>验证rsync可以看到新增的account, container, object信息。  </p>
<h2 id="Optional-Setting-up-rsyslog-for-individual-logging"><a href="#Optional-Setting-up-rsyslog-for-individual-logging" class="headerlink" title="Optional: Setting up rsyslog for individual logging"></a>Optional: Setting up rsyslog for individual logging</h2><p>将&#x2F;etc&#x2F;rsyslog.d&#x2F;10-swift.conf文件内容修改为：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Uncomment the following to have a log containing all logs together</span></span><br><span class="line"><span class="comment">#local1,local2,local3,local4,local5.*   /var/log/swift/all.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment the following to have hourly proxy logs for stats processing</span></span><br><span class="line"><span class="comment">#$template HourlyProxyLog,&quot;/var/log/swift/hourly/%$YEAR%%$MONTH%%$DAY%%$HOUR%&quot;</span></span><br><span class="line"><span class="comment">#local1.*;local1.!notice ?HourlyProxyLog</span></span><br><span class="line"></span><br><span class="line">local1.*;local1.!notice /var/log/swift/proxy.log</span><br><span class="line">local1.notice           /var/log/swift/proxy.error</span><br><span class="line">local1.*                ~ </span><br><span class="line"></span><br><span class="line">local2.*;local2.!notice /var/log/swift/storage1.<span class="built_in">log</span></span><br><span class="line">local2.notice           /var/log/swift/storage1.error</span><br><span class="line">local2.*                ~</span><br><span class="line"></span><br><span class="line">local3.*;local3.!notice /var/log/swift/storage2.<span class="built_in">log</span></span><br><span class="line">local3.notice           /var/log/swift/storage2.error</span><br><span class="line">local3.*                ~</span><br><span class="line"></span><br><span class="line">local4.*;local4.!notice /var/log/swift/storage3.<span class="built_in">log</span></span><br><span class="line">local4.notice           /var/log/swift/storage3.error</span><br><span class="line">local4.*                ~</span><br><span class="line"></span><br><span class="line">local5.*;local5.!notice /var/log/swift/storage4.<span class="built_in">log</span></span><br><span class="line">local5.notice           /var/log/swift/storage4.error</span><br><span class="line">local5.*                ~</span><br><span class="line"></span><br><span class="line">local6.*;local6.!notice /var/log/swift/storage5.<span class="built_in">log</span></span><br><span class="line">local6.notice           /var/log/swift/storage5.error</span><br><span class="line">local6.*                ~</span><br><span class="line"></span><br><span class="line">local7.*;local7.!notice /var/log/swift/expirer.log</span><br><span class="line">local7.notice           /var/log/swift/expirer.error</span><br><span class="line">local7.*                ~</span><br></pre></td></tr></table></figure>
<p>修改日志配置，将原来的local6指向storage node 5, 原来的expirer用local7来记录日志（<code>注意：后面在修改各个节点的服务配置文件时需要知道这些日志配置信息</code>）。 </p>
<h2 id="Configuring-each-node"><a href="#Configuring-each-node" class="headerlink" title="Configuring each node"></a>Configuring each node</h2><ol start="3">
<li>&#x2F;etc&#x2F;swift&#x2F;object-expirer.conf</li>
</ol>
<p>修改前：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_facility = LOG_LOCAL6     </span><br></pre></td></tr></table></figure>

<p>修改后：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_facility = LOG_LOCAL7</span><br></pre></td></tr></table></figure>

<ul>
<li>新增account5的配置文件 &#x2F;etc&#x2F;swift&#x2F;account-server&#x2F;5.conf：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">devices = /srv/5/node</span><br><span class="line">mount_check = <span class="literal">false</span></span><br><span class="line">disable_fallocate = <span class="literal">true</span></span><br><span class="line">bind_port = 6052</span><br><span class="line">workers = 1</span><br><span class="line">user = swift</span><br><span class="line">log_facility = LOG_LOCAL6</span><br><span class="line">recon_cache_path = /var/cache/swift5</span><br><span class="line">eventlet_debug = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[pipeline:main]</span><br><span class="line">pipeline = recon account-server</span><br><span class="line"></span><br><span class="line">[app:account-server]</span><br><span class="line">use = egg:swift#account</span><br><span class="line"></span><br><span class="line">[filter:recon]</span><br><span class="line">use = egg:swift#recon</span><br><span class="line"></span><br><span class="line">[account-replicator]</span><br><span class="line">vm_test_mode = <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">[account-auditor]</span><br><span class="line"></span><br><span class="line">[account-reaper]</span><br></pre></td></tr></table></figure>
<ul>
<li>新增container5的配置文件&#x2F;etc&#x2F;swift&#x2F;container-server&#x2F;5.conf：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">devices = /srv/5/node</span><br><span class="line">mount_check = <span class="literal">false</span></span><br><span class="line">disable_fallocate = <span class="literal">true</span></span><br><span class="line">bind_port = 6051</span><br><span class="line">workers = 1</span><br><span class="line">user = swift</span><br><span class="line">log_facility = LOG_LOCAL6</span><br><span class="line">recon_cache_path = /var/cache/swift5</span><br><span class="line">eventlet_debug = <span class="literal">true</span></span><br><span class="line">allow_versions = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[pipeline:main]</span><br><span class="line">pipeline = recon container-server</span><br><span class="line"></span><br><span class="line">[app:container-server]</span><br><span class="line">use = egg:swift#container</span><br><span class="line"></span><br><span class="line">[filter:recon]</span><br><span class="line">use = egg:swift#recon</span><br><span class="line"></span><br><span class="line">[container-replicator]</span><br><span class="line">vm_test_mode = <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">[container-updater]</span><br><span class="line"></span><br><span class="line">[container-auditor]</span><br><span class="line"></span><br><span class="line">[container-sync]</span><br></pre></td></tr></table></figure>
<ul>
<li>新增object5的配置文件&#x2F;etc&#x2F;swift&#x2F;object-server&#x2F;5.conf：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">devices = /srv/5/node</span><br><span class="line">mount_check = <span class="literal">false</span></span><br><span class="line">disable_fallocate = <span class="literal">true</span></span><br><span class="line">bind_port = 6050</span><br><span class="line">workers = 1</span><br><span class="line">user = swift</span><br><span class="line">log_facility = LOG_LOCAL6</span><br><span class="line">recon_cache_path = /var/cache/swift5</span><br><span class="line">eventlet_debug = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[pipeline:main]</span><br><span class="line">pipeline = recon object-server</span><br><span class="line"></span><br><span class="line">[app:object-server]</span><br><span class="line">use = egg:swift#object</span><br><span class="line"></span><br><span class="line">[filter:recon]</span><br><span class="line">use = egg:swift#recon</span><br><span class="line"></span><br><span class="line">[object-replicator]</span><br><span class="line">vm_test_mode = <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">[object-updater]</span><br><span class="line"></span><br><span class="line">[object-auditor]</span><br></pre></td></tr></table></figure>
<h2 id="Setting-up-scripts-for-running-Swift"><a href="#Setting-up-scripts-for-running-Swift" class="headerlink" title="Setting up scripts for running Swift"></a>Setting up scripts for running Swift</h2><ol start="7">
<li>Construct the initial rings using the provided script:</li>
</ol>
<p>先修改bin&#x2F;remakerings文件，在执行remakerings命令：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /etc/swift</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f *.builder *.ring.gz backups/*.builder backups/*.ring.gz</span><br><span class="line"></span><br><span class="line">swift-ring-builder object.builder create 19 6 1</span><br><span class="line">swift-ring-builder object.builder add r1z1-127.0.0.1:6010/dev1 1</span><br><span class="line">swift-ring-builder object.builder add r1z1-127.0.0.1:6010/dev2 1</span><br><span class="line">swift-ring-builder object.builder add r1z2-127.0.0.1:6020/dev3 1</span><br><span class="line">swift-ring-builder object.builder add r1z2-127.0.0.1:6020/dev4 1</span><br><span class="line">swift-ring-builder object.builder add r1z3-127.0.0.1:6030/dev5 1</span><br><span class="line">swift-ring-builder object.builder add r1z3-127.0.0.1:6030/dev6 1</span><br><span class="line">swift-ring-builder object.builder add r2z1-127.0.0.1:6040/dev7 1</span><br><span class="line">swift-ring-builder object.builder add r2z1-127.0.0.1:6040/dev8 1</span><br><span class="line">swift-ring-builder object.builder add r2z2-127.0.0.1:6050/dev9 1</span><br><span class="line">swift-ring-builder object.builder add r2z2-127.0.0.1:6050/dev10 1</span><br><span class="line">swift-ring-builder object.builder rebalance</span><br><span class="line">swift-ring-builder container.builder create 19 6 1</span><br><span class="line">swift-ring-builder container.builder add r1z1-127.0.0.1:6011/dev1 1</span><br><span class="line">swift-ring-builder container.builder add r1z1-127.0.0.1:6011/dev2 1</span><br><span class="line">swift-ring-builder container.builder add r1z2-127.0.0.1:6021/dev3 1</span><br><span class="line">swift-ring-builder container.builder add r1z2-127.0.0.1:6021/dev4 1</span><br><span class="line">swift-ring-builder container.builder add r1z3-127.0.0.1:6031/dev5 1</span><br><span class="line">swift-ring-builder container.builder add r1z3-127.0.0.1:6031/dev6 1</span><br><span class="line">swift-ring-builder container.builder add r2z1-127.0.0.1:6041/dev7 1</span><br><span class="line">swift-ring-builder container.builder add r2z1-127.0.0.1:6041/dev8 1</span><br><span class="line">swift-ring-builder container.builder add r2z2-127.0.0.1:6051/dev9 1</span><br><span class="line">swift-ring-builder container.builder add r2z2-127.0.0.1:6051/dev10 1</span><br><span class="line">swift-ring-builder container.builder rebalance</span><br><span class="line">swift-ring-builder account.builder create 19 6 1</span><br><span class="line">swift-ring-builder account.builder add r1z1-127.0.0.1:6012/dev1 1</span><br><span class="line">swift-ring-builder account.builder add r1z1-127.0.0.1:6012/dev2 1</span><br><span class="line">swift-ring-builder account.builder add r1z2-127.0.0.1:6022/dev3 1</span><br><span class="line">swift-ring-builder account.builder add r1z2-127.0.0.1:6022/dev4 1</span><br><span class="line">swift-ring-builder account.builder add r1z3-127.0.0.1:6032/dev5 1</span><br><span class="line">swift-ring-builder account.builder add r1z3-127.0.0.1:6032/dev6 1</span><br><span class="line">swift-ring-builder account.builder add r2z1-127.0.0.1:6042/dev7 1</span><br><span class="line">swift-ring-builder account.builder add r2z1-127.0.0.1:6042/dev8 1</span><br><span class="line">swift-ring-builder account.builder add r2z2-127.0.0.1:6052/dev9 1</span><br><span class="line">swift-ring-builder account.builder add r2z2-127.0.0.1:6052/dev10 1</span><br><span class="line">swift-ring-builder account.builder rebalance</span><br></pre></td></tr></table></figure>
<p>新ring环有2的19次方，6个副本，修改后重新生成ring环即可。</p>
</div>

</article>
<section id="appreciates">
  <center>
	<h2>赞赏</h2>
    <div class="post-footer">
      <div>
	    <h4>如果文章对您有所帮助，可以捐赠我喝杯咖啡😌，捐赠方式：</h4>
        <div class="digital-wallet">
          <h6>BTC 地址：3LYgSyf7ddMALwGWPQr3PY4wzjsTDdg1oV</h6>
          <h6>ETH 地址：0x0C9b27c89A61aadb0aEC24CA8949910Cbf77Aa73</h6>
        </div>
        <div class="wechat_appreciates">
          <img src="/images/wechat_appreciates.png" alt="qrcode" width="250" >
        </div>
      </div>
      <div>
	    <h4>文章已同步更新公众号，欢迎关注</h4>
        <div class="wechat_appreciates">
          <img src="/images/wxgzh_qrcode.jpg" alt="qrcode" width="250" >
        </div>
      </div>
    </div>
  </center>
</section>



    
      <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = 'https://zhaozhiming.github.io/2014/04/09/swift-multiply-nodes-deploy-in-one-machine/';
            this.page.identifier = 'https://zhaozhiming.github.io/2014/04/09/swift-multiply-nodes-deploy-in-one-machine/';
        };

        (function() {
          var d = document, s = d.createElement('script');
          s.src = '//zhaozhiming.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

</div>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2024

    赵芝明
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a target="_blank" rel="noopener" href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a target="_blank" rel="noopener" href="http://github.com/panks/fabric">fabric</a> by <a target="_blank" rel="noopener" href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5608723650603289" crossorigin="anonymous"></script>
</body>
</html>
