<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>ä½¿ç”¨Vagrantå’ŒAnsibleæ­å»ºCephç¯å¢ƒ - Hacker and Geeker&#39;s Way</title>
    <meta name="author" content="">
    
	<meta name="description" content="ä½¿ç”¨Vagrantå’ŒAnsibleéƒ¨ç½²Cephç¯å¢ƒ"> <!-- TODO: truncate -->
	<meta name="keywords" content="vagrant,ansible,ceph">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="Hacker and Geeker&#39;s Way" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='/stylesheets/font.css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Amethysta+One' rel='stylesheet' type='text/css'>
	  <script src="/javascripts/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-100485541-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Hacker and Geeker&#39;s Way
    </div>
</h1>
<span class="subtitle"></span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a target="_blank" rel="noopener" href="https://github.com/zhaozhiming" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.twitter.com/kingzzm" class="twitter" title="Twitter"></a>
  </li>
  
  
  <!-- LinkedIn -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.linkedin.com/in/zhaozhiming" class="linkedin" title="LinkedIn"></a>
  </li>
  
  
  
  
  
  <!-- Stackoverflow -->
  <li>
  <a target="_blank" rel="noopener" href="http://stackoverflow.com/users/1954315/zhaozhiming" class="stackoverflow" title="Stackoverflow"></a>
  </li>
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li><a href="/about/index.html">About</a></li>
    
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="https://zhaozhiming.github.io" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>


<div id="toload">
<!-- begin toload -->
    <div id="content">
        <div class="inner">
<article class="post">
	<h2 class="title">ä½¿ç”¨Vagrantå’ŒAnsibleæ­å»ºCephç¯å¢ƒ</h2>
    <div class="meta">
        <div class="date">Published on: <time datetime="2014-10-02T14:03:00.000Z" itemprop="datePublished">10æœˆ 2, 2014</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/ceph/">ceph</a> <a href="/tags/vagrant/">vagrant</a> <a href="/tags/ansible/">ansible</a>
</div>
    </div>
	<div class="entry-content"><img src="/images/post/2014-9/ceph-install.jpg" class="">  
<h2 id="Cephç®€ä»‹"><a href="#Cephç®€ä»‹" class="headerlink" title="Cephç®€ä»‹"></a><a target="_blank" rel="noopener" href="http://ceph.com/">Ceph</a>ç®€ä»‹</h2><p>Cephæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨ï¼Œé«˜æ‰©å±•çš„åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨æ¡†æ¶å’Œæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªå…è´¹å¼€æºçš„é¡¹ç›®ã€‚  </p>
<p>ä½†æ˜¯Cephçš„ç¯å¢ƒæ­å»ºèµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæœ€ç®€å•çš„ç¯å¢ƒä¹Ÿéœ€è¦2å°VM(è™šæ‹Ÿæœºï¼Œ1å°åšmonå’Œosdï¼Œå¦å¤–ä¸€å°åšgateway)ï¼Œè€Œä¸”æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ä¸Šé¢çš„æŒ‡å—è¿›è¡Œå®‰è£…ï¼Œç»å¸¸æŠ¥å„ç§è«åå…¶å¦™çš„é—®é¢˜ï¼Œç°åœ¨ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥è¿›è¡ŒCephç¯å¢ƒçš„æ­å»ºã€‚ä¸‹é¢å…ˆä»‹ç»å‡ ä¸ªè¦ç”¨åˆ°çš„å·¥å…·ã€‚  </p>
<span id="more"></span>
<h2 id="Vagrant"><a href="#Vagrant" class="headerlink" title="Vagrant"></a><a target="_blank" rel="noopener" href="https://www.vagrantup.com/">Vagrant</a></h2><img src="/images/post/2014-9/vagrant.png" class="">  
<p>ä»¥å‰ä½¿ç”¨VMæƒ…å†µæ˜¯è¿™æ ·çš„:   </p>
<ul>
<li>ä¸‹è½½æ“ä½œç³»ç»Ÿçš„isoé•œåƒ</li>
<li>é€šè¿‡VMç®¡ç†å·¥å…·(VMWareï¼ŒVirtualBoxç­‰)å°†isoé•œåƒè½¬æ¢ä¸ºVM</li>
<li>ç™»é™†åˆ°VMè¿›è¡Œæ“ä½œ</li>
</ul>
<p>æ•´ä¸ªè¿‡ç¨‹å¤æ‚è€Œä¸”æ¼«é•¿ï¼Œä½†æ˜¯ä½¿ç”¨äº†Vagrantä¹‹åå°±éå¸¸æ–¹ä¾¿äº†ï¼Œä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æå®šVMçš„å®‰è£…ï¼Œsshåˆ°VMä¹Ÿæ— éœ€è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰VMçš„çŠ¶æ€ç­‰ã€‚  </p>
<h3 id="Box"><a href="#Box" class="headerlink" title="Box"></a>Box</h3><p>vagranté€šè¿‡boxæ¥ç”ŸæˆVMï¼Œboxå¯ä»¥ç†è§£æ˜¯ä¸€ä¸ªåˆ¶ä½œå¥½çš„VMï¼Œè¿™æ„å‘³ç€ä½ æ­å»ºå®Œè‡ªå·±çš„å¼€å‘ç¯å¢ƒåï¼Œä¹Ÿå¯ä»¥å°†å…¶åˆ¶ä½œæˆä¸€ä¸ªboxï¼Œä¾›å›¢é˜Ÿå…¶ä»–æˆå‘˜ä½¿ç”¨ã€‚  </p>
<p>boxçš„å®¹é‡éå¸¸å°ï¼Œæ¯”å¦‚Ubuntu12.04çš„ä¸€ä¸ªisoé•œåƒä¸€èˆ¬è¦500å¤šMï¼Œåˆ¶ä½œæˆVMå¯èƒ½è¦10Gå·¦å³ï¼Œè€Œä¸€ä¸ªubuntu12.04çš„boxåªæœ‰300å¤šMã€‚Vagrantçš„boxå¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://vagrantcloud.com/discover/featured">è¿™é‡Œ</a>ä¸‹è½½ï¼Œé™¤äº†æœ‰å„ç§OS(ubuntu, windosw, CentOSç­‰)çš„VMå¤–ï¼Œè¿˜æœ‰Virtualboxå’ŒVMWareå„è‡ªå¯¹åº”çš„boxï¼Œä¸è¿‡è¦ä½¿ç”¨VMWareçš„boxï¼Œéœ€è¦å®‰è£…æ’ä»¶å’Œåˆ°è´­ä¹°ç›¸å…³çš„<a target="_blank" rel="noopener" href="https://www.vagrantup.com/VMware">License</a>ï¼Œæ¯•ç«ŸVMWareä¸æ˜¯å…è´¹çš„è½¯ä»¶ã€‚  </p>
<p>ä¸‹è½½äº†boxåï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å°±å¯ä»¥æ·»åŠ boxäº†ï¼Œå¦‚æœç›´æ¥è¾“å…¥boxåç§°å¹¶å‘ç°æœ¬åœ°æ²¡æœ‰boxçš„è¯ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½boxæ–‡ä»¶ã€‚(<code>PS: Vagranté»˜è®¤ä½¿ç”¨Virtualboxä½œä¸ºè™šæ‹Ÿå™¨è½¯ä»¶ï¼Œæ‰€ä»¥åœ¨å®‰è£…Vagrantè¿˜éœ€è¦å…ˆå®‰è£…Virtualboxã€‚</code>)  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//æ·»åŠ æœ¬åœ°boxæ–‡ä»¶</span><br><span class="line">$ vagrant box add /your/box/path/xxx.box</span><br><span class="line">//æ·»åŠ æŒ‡å®šåç§°çš„boxï¼Œæ²¡æœ‰çš„è¯ä¼šè‡ªåŠ¨ä¸‹è½½boxæ–‡ä»¶</span><br><span class="line">$ vagrant box add hashicorp/precise32</span><br><span class="line">//åˆ—å‡ºæ‰€æœ‰çš„box</span><br><span class="line">$ vagrant box list</span><br></pre></td></tr></table></figure>   
<h3 id="VagrantåŸºæœ¬æ“ä½œ"><a href="#VagrantåŸºæœ¬æ“ä½œ" class="headerlink" title="VagrantåŸºæœ¬æ“ä½œ"></a>VagrantåŸºæœ¬æ“ä½œ</h3><p>Vagrantçš„æ“ä½œéå¸¸ç®€å•ï¼Œç°åœ¨ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„æ“ä½œæŒ‡ä»¤ã€‚(<code>PS: ä¸‹é¢çš„å¤§éƒ¨åˆ†å‘½ä»¤åé¢å¯ä»¥è·ŸVMåç§°ï¼Œä¸è·Ÿçš„è¯æ˜¯å¯¹æ‰€æœ‰çš„VMè¿›è¡Œæ“ä½œã€‚</code>)  </p>
<ul>
<li>vagrant status: å±•ç¤ºVMçš„ä¿¡æ¯ã€‚</li>
<li>vagrant up: å¯åŠ¨VMã€‚</li>
<li>vagrant ssh [VM]: sshåˆ°æŸä¸ªVMä¸Šï¼Œæ— éœ€è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</li>
<li>vagrant halt: å…³é—­VMã€‚</li>
<li>vagrant destroy: é”€æ¯VMï¼Œå¦‚æœä½ çš„VMè¢«ä½ ç©æ®‹äº†ï¼Œé”€æ¯å®ƒç„¶åé‡æ–°å¯åŠ¨ä¸€ä¸ªå°±å¯ä»¥äº†ï¼Œå¾ˆæ–¹ä¾¿ã€‚</li>
</ul>
<h3 id="Vagrantå…±äº«"><a href="#Vagrantå…±äº«" class="headerlink" title="Vagrantå…±äº«"></a>Vagrantå…±äº«</h3><p>ä½¿ç”¨<code>vagrant ssh</code>åˆ°VMåï¼Œå¯ä»¥çœ‹åˆ°æ ¹ç›®å½•ä¸‹æœ‰ä¸ª<code>/vagrant</code>æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ˜¯VMå’Œå·¥ç¨‹é—´çš„å…±äº«ç›®å½•ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢å­˜æ”¾ä¸œè¥¿ï¼Œå¯ä»¥åœ¨å­˜æ”¾Vagrantfileçš„ç›®å½•é‡Œé¢çœ‹åˆ°ï¼Œåä¹‹äº¦ç„¶ï¼Œåœ¨VMé‡Œé¢ä¹Ÿå¯ä»¥è¯»å–åˆ°å·¥ç¨‹ä¸‹çš„æ–‡ä»¶ã€‚  </p>
<h3 id="Vagrantfile"><a href="#Vagrantfile" class="headerlink" title="Vagrantfile"></a>Vagrantfile</h3><p>åˆå§‹åŒ–vagrantå·¥ç¨‹åå¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>Vagrantfile</code>çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯é…ç½®VMçš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹ä¸‹é¢çš„ä¾‹å­:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">VAGRANTFILE_API_VERSION</span> = <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vagrant</span>.configure(<span class="variable constant_">VAGRANTFILE_API_VERSION</span>) <span class="keyword">do</span> |<span class="params">config</span>|</span><br><span class="line">  config.<span class="variable constant_">VM</span>.box = <span class="string">&quot;hashicorp/precise64&quot;</span></span><br><span class="line"></span><br><span class="line">  config.<span class="variable constant_">VM</span>.define <span class="symbol">:rgw</span> <span class="keyword">do</span> |<span class="params">rgw</span>|</span><br><span class="line">    rgw.<span class="variable constant_">VM</span>.network <span class="symbol">:private_network</span>, <span class="symbol">ip:</span> <span class="string">&quot;192.168.42.2&quot;</span></span><br><span class="line">    rgw.<span class="variable constant_">VM</span>.host_name = <span class="string">&quot;ceph-rgw&quot;</span></span><br><span class="line">    rgw.<span class="variable constant_">VM</span>.provider <span class="symbol">:virtualbox</span> <span class="keyword">do</span> |<span class="params">vb</span>|</span><br><span class="line">      vb.customize [<span class="string">&quot;modifyVM&quot;</span>, <span class="symbol">:id</span>, <span class="string">&quot;--memory&quot;</span>, <span class="string">&quot;192&quot;</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    rgw.<span class="variable constant_">VM</span>.provider <span class="symbol">:VMware_fusion</span> <span class="keyword">do</span> |<span class="params">v</span>|</span><br><span class="line">      v.<span class="title class_">VMx</span>[<span class="string">&#x27;memsize&#x27;</span>] = <span class="string">&#x27;192&#x27;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>   
<p>è¿™ä¸ªVagrantfileæŒ‡å®šäº†boxçš„åç§°ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªåç§°ä¸º<code>rgw</code>çš„VMï¼ŒæŒ‡å®šäº†VMçš„ipã€hostnameã€å†…å­˜å¤§å°ã€‚  </p>
<p>å…³äºvagrantå°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæƒ³è¦äº†è§£æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://www.vagrantup.com/">vagrantå®˜ç½‘</a>ã€‚  </p>
<h2 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a><a target="_blank" rel="noopener" href="http://www.ansible.com/home">Ansible</a></h2><img src="/images/post/2014-9/ansible.jpg" class="">  
<p>Ansibleæ˜¯ä¸€ä¸ªå¼€æºçš„è¿œç¨‹æœºå™¨ç®¡ç†è½¯ä»¶ï¼Œå¯ä»¥æ‰¹é‡æ“ä½œå¤šå°è¿œç¨‹æœåŠ¡å™¨ã€‚(<code>PS: Ansibleåªé€‚åˆæ“ä½œLinuxå’ŒUnixæœºå™¨ï¼Œå¦‚æœæ˜¯Windowsç³»ç»Ÿæ˜¯ä¸å¯ä»¥çš„ã€‚</code>)  </p>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>è¦å®‰è£…Ansibleéœ€è¦å…ˆå®‰è£…Python2.6&#x2F;7ï¼Œç„¶åå¯ä»¥é€šè¿‡easy_installæˆ–pipè¿›è¡Œä¸‹è½½å®‰è£…ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> esay_install ansible</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="built_in">sudo</span> pip install ansible</span><br></pre></td></tr></table></figure>   
<h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹é‡Œé¢åˆ›å»ºä¸€ä¸ªhostsæ–‡ä»¶ï¼Œhostsæ ¼å¼å¦‚ä¸‹:   </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hosts</span></span><br><span class="line">[ceph]</span><br><span class="line">192.168.42.2</span><br><span class="line">192.168.42.101</span><br><span class="line">192.168.42.201</span><br></pre></td></tr></table></figure>   
<p>å¯ä»¥çœ‹åˆ°hostsæ–‡ä»¶é‡Œé¢æœ‰å‡ ä¸ªè¿œç¨‹æœºå™¨çš„ip(è¿™é‡Œæ˜¯è™šæ‹Ÿæœº)ï¼Œè¿œç¨‹æœºå™¨å¯ä»¥åˆ†ç»„ï¼Œé€šè¿‡ä¸­æ‹¬å·é‡Œé¢çš„ç»„åæ¥åˆ’åˆ†ã€‚  </p>
<p>ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ‰§è¡Œç®€å•çš„å‘½ä»¤ã€‚  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -a <span class="string">&#x27;who&#x27;</span></span><br><span class="line">ceph-mon0 | success | rc=0 &gt;&gt;</span><br><span class="line">ceph     pts/0        2014-10-02 08:54 (192.168.42.60)</span><br><span class="line"></span><br><span class="line">ceph-osd0 | success | rc=0 &gt;&gt;</span><br><span class="line">ceph     pts/0        2014-10-02 08:54 (192.168.42.60)</span><br><span class="line"></span><br><span class="line">ceph-osd1 | success | rc=0 &gt;&gt;</span><br><span class="line">ceph     pts/0        2014-10-02 08:54 (192.168.42.60)</span><br></pre></td></tr></table></figure>   
<p>ä»è¾“å‡ºä¿¡æ¯ä¸Šå¯ä»¥çœ‹åˆ°è¿™å‡ å°è¿œç¨‹æœºå™¨éƒ½æˆåŠŸæ‰§è¡Œäº†<code>who</code>å‘½ä»¤ï¼Œä¸è¿‡å¦‚æœè¦æˆåŠŸæ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œè¿˜éœ€è¦å…ˆåœ¨æ‰§è¡Œæœºå’Œè¿œç¨‹æœºä¸Šé¢è®¾ç½®æ— å¯†ç sshè¿æ¥ã€‚  </p>
<h3 id="æ— å¯†ç sshè¿æ¥"><a href="#æ— å¯†ç sshè¿æ¥" class="headerlink" title="æ— å¯†ç sshè¿æ¥"></a>æ— å¯†ç sshè¿æ¥</h3><p>å‡è®¾æœ‰2å°æœºå™¨ï¼Œæœºå™¨Aå’Œæœºå™¨Bï¼Œç°åœ¨æƒ³è®©æœºå™¨A<code>ssh</code>æœºå™¨Bçš„æ—¶å€™ä¸éœ€è¦è¾“å…¥ç”¨æˆ·å’Œå¯†ç ï¼Œæ“ä½œå¦‚ä¸‹ã€‚  </p>
<ul>
<li>åœ¨æœºå™¨Bä¸Šåˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶é…ç½®å¥½ï¼Œä¸‹é¢å‘½ä»¤çš„<code>username</code>æŒ‡è‡ªå·±è¦åˆ›å»ºçš„ç”¨æˆ·åã€‚</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> useradd -d /home/&#123;username&#125; -m &#123;username&#125;</span><br><span class="line">$ <span class="built_in">sudo</span> passwd &#123;username&#125;</span><br><span class="line"><span class="comment"># è¾“å…¥å¯†ç </span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;&#123;username&#125; ALL = (root) NOPASSWD:ALL&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/sudoers.d/&#123;username&#125;</span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">chmod</span> 0440 /etc/sudoers.d/&#123;username&#125;</span><br></pre></td></tr></table></figure>   
<ul>
<li>åœ¨æœºå™¨Aä¸Šç”Ÿæˆå¯†é’¥ï¼Œå¹¶å‘é€ç»™æœºå™¨Bã€‚</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen</span><br><span class="line"></span><br><span class="line">Generating public/private key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/ceph-admin/.ssh/id_rsa):</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /ceph-admin/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /ceph-admin/.ssh/id_rsa.pub.</span><br><span class="line"></span><br><span class="line">$ ssh-copy-id &#123;username&#125;@&#123;æœºå™¨B&#125;</span><br></pre></td></tr></table></figure>   
<ul>
<li>åˆ°è¿™é‡Œå°±å¯ä»¥ä¸ç”¨è¾“å…¥å¯†ç è¿›è¡Œsshäº†ï¼Œå¦‚æœæƒ³è¿ç”¨æˆ·åä¹Ÿä¸æƒ³è¾“å…¥çš„è¯ï¼Œéœ€è¦æœºå™¨Aåœ¨<code>.ssh</code>æ–‡ä»¶ä¸‹åˆ›å»ºä¸€ä¸ª<code>config</code>æ–‡ä»¶ï¼Œåœ¨é‡Œé¢æ·»åŠ å¦‚ä¸‹å†…å®¹ã€‚</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host æœºå™¨B</span><br><span class="line">   Hostname æœºå™¨B</span><br><span class="line">   User &#123;username&#125;</span><br></pre></td></tr></table></figure>   
<h3 id="playbook"><a href="#playbook" class="headerlink" title="playbook"></a>playbook</h3><p>ansibleè¿˜å¯ä»¥é€šè¿‡ä¸€ä¸ªplaybookè„šæœ¬è¿›è¡Œè¿œç¨‹æœºå™¨çš„æ“ä½œï¼Œplaybookçš„ç¤ºä¾‹å¦‚ä¸‹:   </p>
<figure class="highlight yaml"><figcaption><span>playbook.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># playbook.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span> </span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">ceph</span> </span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">whoami</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;whoami &gt; whoami.rst&#x27;</span></span><br></pre></td></tr></table></figure>   
<p>åˆ›å»ºå®Œplaybookæ–‡ä»¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯ä»¥çœ‹åˆ°æ‰§è¡Œç»“æœã€‚  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-playbook playbook.yml </span><br><span class="line"></span><br><span class="line">PLAY [all] ******************************************************************** </span><br><span class="line"></span><br><span class="line">GATHERING FACTS *************************************************************** </span><br><span class="line">ok: [ceph-mon0]</span><br><span class="line">ok: [ceph-osd1]</span><br><span class="line">ok: [ceph-osd0]</span><br><span class="line"></span><br><span class="line">TASK: [<span class="built_in">whoami</span>] **************************************************************** </span><br><span class="line">changed: [ceph-mon0]</span><br><span class="line">changed: [ceph-osd0]</span><br><span class="line">changed: [ceph-osd1]</span><br><span class="line"></span><br><span class="line">PLAY RECAP ******************************************************************** </span><br><span class="line">ceph-mon0                  : ok=2    changed=1    unreachable=0    failed=0   </span><br><span class="line">ceph-osd0                  : ok=2    changed=1    unreachable=0    failed=0   </span><br><span class="line">ceph-osd1                  : ok=2    changed=1    unreachable=0    failed=0   </span><br></pre></td></tr></table></figure>   
<p>è¿™æ—¶å¯ä»¥åœ¨è¿œç¨‹æœºå™¨çš„ç”¨æˆ·ç›®å½•ä¸Šå¯ä»¥çœ‹åˆ°æ–°äº§ç”Ÿäº†ä¸€ä¸ª<code>whoami.rst</code>çš„æ–‡ä»¶ã€‚  </p>
<p>å…³äºansibleå°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæƒ³è¦äº†è§£æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹<a target="_blank" rel="noopener" href="http://docs.ansible.com/">ansibleçš„æ–‡æ¡£</a>ã€‚  </p>
<h2 id="Ceph-ansible"><a href="#Ceph-ansible" class="headerlink" title="Ceph-ansible"></a><a target="_blank" rel="noopener" href="https://github.com/ceph/ceph-ansible">Ceph-ansible</a></h2><p>è¿™ä¸ªgithubé¡¹ç›®ä¸»è¦æ˜¯åˆ©ç”¨äº†ä¸Šé¢ä»‹ç»çš„2ä¸ªå·¥å…·ï¼Œä½¿ç”¨vagrantæ¥åˆ›å»ºcephéœ€è¦çš„æœåŠ¡å™¨VMï¼Œç„¶åå°†cephçš„ç¯å¢ƒæ­å»ºé€šè¿‡ansibleçš„playbookè„šæœ¬æ‰§è¡Œã€‚  </p>
<h3 id="æ‰§è¡Œæ­¥éª¤"><a href="#æ‰§è¡Œæ­¥éª¤" class="headerlink" title="æ‰§è¡Œæ­¥éª¤"></a>æ‰§è¡Œæ­¥éª¤</h3><ul>
<li>ä¸‹è½½ceph-ansibleé¡¹ç›®;</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/ceph/ceph-ansible.git</span><br></pre></td></tr></table></figure>   
<ul>
<li>ä¸€è¡Œå‘½ä»¤å°±å¯ä»¥å®Œæˆç¯å¢ƒæ­å»ºï¼Œå®Œæˆåcephçš„ç¯å¢ƒæ˜¯: 3ä¸ªmonï¼Œ3ä¸ªosdï¼Œ1ä¸ªrgw;</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ vagrant up</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">mon0                       : ok=16   changed=11   unreachable=0    failed=0</span><br><span class="line">mon1                       : ok=16   changed=10   unreachable=0    failed=0</span><br><span class="line">mon2                       : ok=16   changed=11   unreachable=0    failed=0</span><br><span class="line">osd0                       : ok=19   changed=7    unreachable=0    failed=0</span><br><span class="line">osd1                       : ok=19   changed=7    unreachable=0    failed=0</span><br><span class="line">osd2                       : ok=19   changed=7    unreachable=0    failed=0</span><br><span class="line">rgw                        : ok=20   changed=17   unreachable=0    failed=0</span><br></pre></td></tr></table></figure>   
</div>

</article>
<section id="appreciates">
  <center>
	<h2>èµèµ</h2>
    <div class="post-footer">
      <div>
	    <h4>å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå¯ä»¥æèµ æˆ‘å–æ¯å’–å•¡ğŸ˜Œï¼Œæèµ æ–¹å¼ï¼š</h4>
        <div class="digital-wallet">
          <h6>BTC åœ°å€ï¼š3LYgSyf7ddMALwGWPQr3PY4wzjsTDdg1oV</h6>
          <h6>ETH åœ°å€ï¼š0x0C9b27c89A61aadb0aEC24CA8949910Cbf77Aa73</h6>
        </div>
        <div class="wechat_appreciates">
          <img src="/images/wechat_appreciates.png" alt="qrcode" width="250" >
        </div>
      </div>
      <div>
	    <h4>æ–‡ç« å·²åŒæ­¥æ›´æ–°å…¬ä¼—å·ï¼Œæ¬¢è¿å…³æ³¨</h4>
        <div class="wechat_appreciates">
          <img src="/images/wxgzh_qrcode.jpg" alt="qrcode" width="250" >
        </div>
      </div>
    </div>
  </center>
</section>



    
      <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = 'https://zhaozhiming.github.io/2014/10/02/ceph-install-with-vagrant-and-ansible/';
            this.page.identifier = 'https://zhaozhiming.github.io/2014/10/02/ceph-install-with-vagrant-and-ansible/';
        };

        (function() {
          var d = document, s = d.createElement('script');
          s.src = '//zhaozhiming.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

</div>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2025

    èµµèŠæ˜
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a target="_blank" rel="noopener" href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a target="_blank" rel="noopener" href="http://github.com/panks/fabric">fabric</a> by <a target="_blank" rel="noopener" href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5608723650603289" crossorigin="anonymous"></script>
</body>
</html>
