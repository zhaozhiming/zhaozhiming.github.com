<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>å¦‚ä½•åœ¨Spring4ä¸­é…ç½®Mybatis - Hacker and Geeker&#39;s Way</title>
    <meta name="author" content="">
    
	<meta name="description" content="å¦‚ä½•åœ¨Spring4ä¸­é…ç½®Mybatis"> <!-- TODO: truncate -->
	<meta name="keywords" content="spring,mybatis">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="Hacker and Geeker&#39;s Way" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='/stylesheets/font.css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Amethysta+One' rel='stylesheet' type='text/css'>
	  <script src="/javascripts/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-100485541-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Hacker and Geeker&#39;s Way
    </div>
</h1>
<span class="subtitle"></span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a target="_blank" rel="noopener" href="https://github.com/zhaozhiming" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.twitter.com/kingzzm" class="twitter" title="Twitter"></a>
  </li>
  
  
  <!-- LinkedIn -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.linkedin.com/in/zhaozhiming" class="linkedin" title="LinkedIn"></a>
  </li>
  
  
  
  
  
  <!-- Stackoverflow -->
  <li>
  <a target="_blank" rel="noopener" href="http://stackoverflow.com/users/1954315/zhaozhiming" class="stackoverflow" title="Stackoverflow"></a>
  </li>
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li><a href="/about/index.html">About</a></li>
    
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="https://zhaozhiming.github.io" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>


<div id="toload">
<!-- begin toload -->
    <div id="content">
        <div class="inner">
<article class="post">
	<h2 class="title">å¦‚ä½•åœ¨Spring4ä¸­é…ç½®Mybatis</h2>
    <div class="meta">
        <div class="date">Published on: <time datetime="2014-11-15T13:09:00.000Z" itemprop="datePublished">11æœˆ 15, 2014</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/spring/">spring</a> <a href="/tags/mybatis/">mybatis</a>
</div>
    </div>
	<div class="entry-content"><img src="/images/post/2014-11/mybatis-spring.png" class="">  
<p><a target="_blank" rel="noopener" href="http://spring.io/">Spring4</a>å·²ç»ä¸æ”¯æŒIbatisäº†ï¼Œä½†Ibatisçš„å‡çº§ç‰ˆ<a target="_blank" rel="noopener" href="http://mybatis.github.io/mybatis-3/zh/index.html">Mybatis</a>å°è£…äº†æ”¯æŒSpring4çš„ç»„ä»¶<a target="_blank" rel="noopener" href="http://mybatis.github.io/spring/zh/">mybatis-spring</a>ï¼Œé€šè¿‡ä½¿ç”¨å®ƒä»¬å¯ä»¥è®©ä½ åœ¨Spring4ä¸­è½»æ¾åœ°ä½¿ç”¨Mybatisã€‚  </p>
<span id="more"></span>

<h2 id="gradle-è®¾ç½®"><a href="#gradle-è®¾ç½®" class="headerlink" title="gradle è®¾ç½®"></a>gradle è®¾ç½®</h2><p>ç°åœ¨åŸºæœ¬ä¸Šæ–°å…´çš„javaé¡¹ç›®åŒ…æ‹¬androidéƒ½ä½¿ç”¨<a target="_blank" rel="noopener" href="http://www.gradle.org/">gradle</a>æ¥åšæ„å»ºå·¥å…·ï¼Œgradleç›¸æ¯”<a target="_blank" rel="noopener" href="http://ant.apache.org/">ant</a>æ¥è®²å¤šäº†å®šä¹‰å¥½çš„taskï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½copy-pasteç›¸åŒçš„taskåˆ°æ„å»ºæ–‡ä»¶ä¸­ï¼Œè€Œç›¸æ¯”<a target="_blank" rel="noopener" href="http://maven.apache.org/">maven</a>æ¥è¯´gradleæ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥åƒanté‚£æ ·å†™ç®€å•çš„å‘½ä»¤æ¥è¿›è¡Œcopyæˆ–è€…mvç­‰æ“ä½œï¼Œæ€»çš„æ¥è®²ï¼Œgradleæ˜¯é›†antå’Œmavenä¼˜ç‚¹äºä¸€èº«çš„æ–°æ—¶ä»£çš„æ„å»ºå·¥å…·ã€‚  </p>
<p>è¦åœ¨å·¥ç¨‹ä¸­å¼•å…¥Mybatisçš„ç»„ä»¶ï¼Œéœ€è¦ç°åœ¨gradleçš„æ„å»ºæ–‡ä»¶ä¸­å¢åŠ Mybatisçš„ä¾èµ–åŒ…ã€‚  </p>
<figure class="highlight groovy"><figcaption><span>build.gradle</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;org.mybatis:mybatis:3.2.8&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;org.mybatis:mybatis-spring:1.2.2&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>   
<h2 id="åœ¨springä¸­é…ç½®Mybatis"><a href="#åœ¨springä¸­é…ç½®Mybatis" class="headerlink" title="åœ¨springä¸­é…ç½®Mybatis"></a>åœ¨springä¸­é…ç½®Mybatis</h2><p>å¼•å…¥ä¾èµ–åŒ…ä¹‹åï¼Œéœ€è¦åœ¨springçš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡ŒMybatisçš„é…ç½®ã€‚  </p>
<ul>
<li>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªdatasourceï¼Œä½¿ç”¨C3POæ•°æ®åº“è¿æ¥æ± æ¥è¿›è¡Œç®¡ç†ã€‚</li>
</ul>
<figure class="highlight xml"><figcaption><span>spring.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource &quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://192.168.36.10:3306/pebms&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;acquireIncrement&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxStatements&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testConnectionOnCheckout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>   
<ul>
<li>æ¥ç€å®šä¹‰Mybatisçš„SessionFactoryã€‚  <ul>
<li>dataSource: æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„æ•°æ®æº</li>
<li>transactionFactory: äº‹åŠ¡ç®¡ç†é…ç½®</li>
<li>configLocation: Mybatisçš„å…·ä½“æ–‡ä»¶åœ°å€</li>
<li>mapperLocations: Mybatisçš„SQLæ˜ å°„æ–‡ä»¶</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><figcaption><span>spring.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;transactionFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.ibatis.transaction.managed.ManagedTransactionFactory&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:sql-map-config.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:sql-mapping/farmer.xml&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>   
<ul>
<li>sql-map-config.xmlç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼Œè®¾ç½®äº†ç¼“å­˜ï¼Œå»¶è¿ŸåŠ è½½ï¼Œè¶…æ—¶æ—¶é—´ç­‰å±æ€§ï¼Œæ›´å¤šçš„é…ç½®å¯ä»¥å‚ç…§<a target="_blank" rel="noopener" href="http://mybatis.github.io/mybatis-3/zh/configuration.html#setting">è¿™é‡Œ</a>ã€‚</li>
</ul>
<figure class="highlight xml"><figcaption><span>sql-map-config.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;multipleResultSetsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useColumnLabel&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultExecutorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;REUSE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultStatementTimeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>   
<ul>
<li>sqlçš„æ˜ å°„æ–‡ä»¶ç®€å•ç¤ºä¾‹å¦‚ä¸‹ã€‚</li>
</ul>
<figure class="highlight xml"><figcaption><span>farmer.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.farmer.baton.repo.FarmerMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add-new-farmer&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.farmer.baton.model.Farmer&quot;</span>&gt;</span></span><br><span class="line">      insert into farmers(id, name, age) values (</span><br><span class="line">        #&#123;id&#125;,</span><br><span class="line">        #&#123;name&#125;,</span><br><span class="line">        #&#123;age&#125;</span><br><span class="line">      )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>   
<ul>
<li>ç»§ç»­åœ¨spring.xmlæ–‡ä»¶é‡Œè¿›è¡ŒMybatisçš„é…ç½®ï¼Œå®šä¹‰Mybatisçš„DAO(æ•°æ®åº“è®¿é—®å¯¹è±¡)å’Œäº‹åŠ¡æ§åˆ¶ï¼Œè¿™é‡Œé…ç½®äº†DAOçš„åŒ…è·¯å¾„ã€‚</li>
</ul>
<figure class="highlight xml"><figcaption><span>spring.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.farmer.baton.repo&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>   
<h2 id="Mybatis-responsitoryç¼–å†™"><a href="#Mybatis-responsitoryç¼–å†™" class="headerlink" title="Mybatis responsitoryç¼–å†™"></a>Mybatis responsitoryç¼–å†™</h2><p>åœ¨å‰é¢çš„springé‡Œé¢é…ç½®äº†DAOçš„åŒ…è·¯å¾„ï¼Œæˆ‘ä»¬ä¸‹é¢è¦åšçš„ä¸œè¥¿å°±æ¯”è¾ƒå°±ç®€å•äº†ã€‚  </p>
<ul>
<li>å…ˆåœ¨DAOåŒ…è·¯å¾„ä¸‹å®šä¹‰ä¸€ä¸ªDAOæ¥å£ï¼Œè¿™é‡Œä¸éœ€è¦å®ç°å…·ä½“çš„å†…å®¹ï¼Œå…·ä½“çš„sqlåœ¨æˆ‘ä»¬çš„æ˜ å°„æ–‡ä»¶é‡Œé¢ä½“ç°ã€‚</li>
</ul>
<figure class="highlight java"><figcaption><span>FarmerRepository.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.farmer.baton.repo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.farmer.baton.model.Farmer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FarmerRepository</span> &#123;</span><br><span class="line">    List&lt;Farmer&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>   
<ul>
<li>åœ¨xmlæ˜ å°„æ–‡ä»¶é‡Œé¢å®ç°findAllæ–¹æ³•ï¼Œè¿™é‡Œè¦æ³¨æ„æ–¹æ³•çš„ç­¾åå¿…é¡»å’Œæ˜ å°„æ–‡ä»¶çš„sqlçš„idä¸€è‡´ï¼ŒåŒ…æ‹¬æ–¹æ³•åå’Œidä¸€è‡´ï¼Œæ–¹æ³•å‚æ•°ç±»å‹å’Œsqlçš„parameterTypeä¸€è‡´ï¼Œæ–¹æ³•è¿”å›ç±»å‹å’Œsqlçš„resultTypeæˆ–resultMapç±»å‹ä¸€è‡´ã€‚</li>
</ul>
<figure class="highlight xml"><figcaption><span>farmer.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.farmer.baton.repo.FarmerRepository&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;baseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.farmer.baton.model.Farmer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;baseResultMap&quot;</span>&gt;</span></span><br><span class="line">        select id as id,</span><br><span class="line">        name as name,</span><br><span class="line">        age as age</span><br><span class="line">        from farmers</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>   
<ul>
<li>å†™å¥½Repositoryå’Œæ˜ å°„SQLå°±å¯ä»¥äº†ï¼Œç¨‹åºåœ¨è°ƒç”¨Repositoryæ–¹æ³•çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æ‰§è¡Œåˆ°ç›¸å…³çš„SQLã€‚</li>
</ul>
<h2 id="äº‹åŠ¡æ§åˆ¶"><a href="#äº‹åŠ¡æ§åˆ¶" class="headerlink" title="äº‹åŠ¡æ§åˆ¶"></a>äº‹åŠ¡æ§åˆ¶</h2><ul>
<li>Mybatisçš„äº‹åŠ¡æ§åˆ¶ä½¿ç”¨Springçš„äº‹åŠ¡é…ç½®å³å¯ï¼Œé…ç½®å¦‚ä¸‹:</li>
</ul>
<figure class="highlight xml"><figcaption><span>spring.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">http:</span>//<span class="attr">www.springframework.org</span>/<span class="attr">schema</span>/<span class="attr">tx</span> <span class="attr">http:</span>//<span class="attr">www.springframework.org</span>/<span class="attr">schema</span>/<span class="attr">tx</span>/<span class="attr">spring-tx-4.0.xsd</span>&quot;&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span>/&gt;</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>   
<ul>
<li>ç„¶ååœ¨è°ƒç”¨Repositoryçš„æ–¹é¢å‰é¢åŠ ä¸ŠTransactionalæ ‡ç­¾ï¼Œå¦‚ä¸‹æ‰€ç¤º:</li>
</ul>
<figure class="highlight java"><figcaption><span>FarmerService.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FarmerService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FarmerRepository farmerRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateTwoFarmers</span><span class="params">(Farmer farmer1, Farmer farmer2)</span> &#123;</span><br><span class="line">        farmerRepository.updateZhangsan(farmer1);</span><br><span class="line">        farmerRepository.updateWangwu(farmer2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>   
<h2 id="Mybatisè¯­æ³•"><a href="#Mybatisè¯­æ³•" class="headerlink" title="Mybatisè¯­æ³•"></a>Mybatisè¯­æ³•</h2><p>Mybatisçš„è¯­æ³•åœ¨åŠŸèƒ½ä¸Šæœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ï¼Œå…·ä½“ä½“ç°åœ¨SQLæ˜ å°„æ–‡ä»¶ä¸­ã€‚  </p>
<ul>
<li>æ‰¹é‡æ’å…¥å¤šæ¡è®°å½•ã€‚</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add-new-farmer&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.farmer.baton.model.Farmer&quot;</span>&gt;</span></span><br><span class="line">  insert into farmers(id, name, age) values </span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;farmers&quot;</span> <span class="attr">item</span>=<span class="string">&quot;farmer&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span>	</span><br><span class="line">  (</span><br><span class="line">    #&#123;id&#125;,</span><br><span class="line">    #&#123;name&#125;,</span><br><span class="line">    #&#123;age&#125;</span><br><span class="line">  )</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>   
<figure class="highlight java"><figcaption><span>FarmerRepository</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">addFarmers</span><span class="params">(<span class="meta">@Param(&quot;farmers&quot;)</span> List&lt;Farmer&gt; farmers)</span>;</span><br></pre></td></tr></table></figure>  
<ul>
<li>å¤šå‚æ•°SQLæ˜ å°„</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;farmer&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.farmer.baton.model.Farmer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectFarmersByNameAndAge&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;farmer&quot;</span>&gt;</span></span><br><span class="line">  select id as id,</span><br><span class="line">    name as name,</span><br><span class="line">    age as age</span><br><span class="line">    from farmers</span><br><span class="line">    where name = #&#123;name&#125;</span><br><span class="line">    and age = #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>   
<figure class="highlight java"><figcaption><span>FarmerRepository.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Farmer&gt; <span class="title function_">selectFarmersByNameAndAge</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;age&quot;)</span> <span class="type">int</span> age)</span>;</span><br></pre></td></tr></table></figure>  
<ul>
<li>è¿”å›å¯¹è±¡å±æ€§åŒ…å«List</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;farmer&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.farmer.baton.model.Farmer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;farmland&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.farmer.baton.model.Farmland&quot;</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;size&quot;</span> <span class="attr">property</span>=<span class="string">&quot;size&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectFarmersAndFarmlands&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;farmer&quot;</span>&gt;</span></span><br><span class="line">  select id as id,</span><br><span class="line">    name as name,</span><br><span class="line">    age as age</span><br><span class="line">    from farmers a </span><br><span class="line">    left outer join farmerlands b on a.id = b.farmer_id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>   
<figure class="highlight java"><figcaption><span>FarmerRepository.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Farmer&gt; <span class="title function_">selectFarmersAndFarmlands</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>  
<figure class="highlight java"><figcaption><span>Farmer.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"><span class="keyword">private</span> List&lt;Farmland&gt; farmlands;</span><br></pre></td></tr></table></figure>  
<p>å…·ä½“çš„Demoå¯ä»¥å‚è€ƒæˆ‘çš„githubå·¥ç¨‹<a target="_blank" rel="noopener" href="https://github.com/zhaozhiming/spring4-mybatis">spring4-mybatis</a>ã€‚  </p>
</div>

</article>
<section id="appreciates">
  <center>
	<h2>èµèµ</h2>
    <div class="post-footer">
      <div>
	    <h4>å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå¯ä»¥æèµ æˆ‘å–æ¯å’–å•¡ğŸ˜Œï¼Œæèµ æ–¹å¼ï¼š</h4>
        <div class="digital-wallet">
          <h6>BTC åœ°å€ï¼š3LYgSyf7ddMALwGWPQr3PY4wzjsTDdg1oV</h6>
          <h6>ETH åœ°å€ï¼š0x0C9b27c89A61aadb0aEC24CA8949910Cbf77Aa73</h6>
        </div>
        <div class="wechat_appreciates">
          <img src="/images/wechat_appreciates.png" alt="qrcode" width="250" >
        </div>
      </div>
      <div>
	    <h4>æ–‡ç« å·²åŒæ­¥æ›´æ–°å…¬ä¼—å·ï¼Œæ¬¢è¿å…³æ³¨</h4>
        <div class="wechat_appreciates">
          <img src="/images/wxgzh_qrcode.jpg" alt="qrcode" width="250" >
        </div>
      </div>
    </div>
  </center>
</section>



    
      <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = 'https://zhaozhiming.github.io/2014/11/15/spring4-and-mybatis/';
            this.page.identifier = 'https://zhaozhiming.github.io/2014/11/15/spring4-and-mybatis/';
        };

        (function() {
          var d = document, s = d.createElement('script');
          s.src = '//zhaozhiming.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

</div>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2025

    èµµèŠæ˜
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a target="_blank" rel="noopener" href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a target="_blank" rel="noopener" href="http://github.com/panks/fabric">fabric</a> by <a target="_blank" rel="noopener" href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5608723650603289" crossorigin="anonymous"></script>
</body>
</html>
