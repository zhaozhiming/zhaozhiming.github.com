<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>ä½¿ç”¨Mocha + chai + sinon æµ‹è¯•React + Reduxçš„webåº”ç”¨ - Hacker and Geeker&#39;s Way</title>
    <meta name="author" content="">
    
	<meta name="description" content="ä½¿ç”¨Mocha + chai + sinon æµ‹è¯•React + Reduxçš„webåº”ç”¨"> <!-- TODO: truncate -->
	<meta name="keywords" content="react, mocha, chai, sinon, redux, test">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="Hacker and Geeker&#39;s Way" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='/stylesheets/font.css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Amethysta+One' rel='stylesheet' type='text/css'>
	  <script src="/javascripts/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-100485541-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Hacker and Geeker&#39;s Way
    </div>
</h1>
<span class="subtitle"></span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a target="_blank" rel="noopener" href="https://github.com/zhaozhiming" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.twitter.com/kingzzm" class="twitter" title="Twitter"></a>
  </li>
  
  
  <!-- LinkedIn -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.linkedin.com/in/zhaozhiming" class="linkedin" title="LinkedIn"></a>
  </li>
  
  
  
  
  
  <!-- Stackoverflow -->
  <li>
  <a target="_blank" rel="noopener" href="http://stackoverflow.com/users/1954315/zhaozhiming" class="stackoverflow" title="Stackoverflow"></a>
  </li>
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li><a href="/about/index.html">About</a></li>
    
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="https://zhaozhiming.github.io" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>


<div id="toload">
<!-- begin toload -->
    <div id="content">
        <div class="inner">
<article class="post">
	<h2 class="title">ä½¿ç”¨Mocha + chai + sinon æµ‹è¯•React + Reduxçš„webåº”ç”¨</h2>
    <div class="meta">
        <div class="date">Published on: <time datetime="2015-12-19T11:29:00.000Z" itemprop="datePublished">12æœˆ 19, 2015</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/react/">react</a> <a href="/tags/mocha/">mocha</a> <a href="/tags/chai/">chai</a> <a href="/tags/sinon/">sinon</a> <a href="/tags/redux/">redux</a> <a href="/tags/test/">test</a>
</div>
    </div>
	<div class="entry-content"><img src="/images/post/2015-12/front_end_test.png" class="">  
<p>ä»Šå¤©æ¥ä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Mocha + Chai + Sinonæµ‹è¯•åŸºäºRedux + Reactçš„webåº”ç”¨ï¼Œä»¥åŠä»‹ç»ä¸€äº›åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•ã€‚  </p>
<span id="more"></span>  
<h2 id="Mocha"><a href="#Mocha" class="headerlink" title="Mocha"></a>Mocha</h2><p><a target="_blank" rel="noopener" href="https://mochajs.org/">Mocha</a>æ˜¯ä¸€ä¸ªJSçš„æµ‹è¯•æ¡†æ¶ï¼Œç±»ä¼¼äºJavaä¸­çš„Junitã€Pythonä¸­çš„noseã€‚Mochaçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œä½¿ç”¨<code>describe</code>å’Œ<code>it</code>å°±å¯ä»¥å†™å•å…ƒæµ‹è¯•ï¼Œä¸‹é¢æ˜¯ä»£ç ç¤ºä¾‹ã€‚  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;expect&#125; <span class="keyword">from</span> <span class="string">&#x27;chai&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Array&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;#indexOf()&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should return -1 when the value is not present&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">expect</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].<span class="title function_">indexOf</span>(<span class="number">5</span>)).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(-<span class="number">1</span>);</span><br><span class="line">      <span class="title function_">expect</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].<span class="title function_">indexOf</span>(<span class="number">0</span>)).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(-<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Chai"><a href="#Chai" class="headerlink" title="Chai"></a>Chai</h2><p><a target="_blank" rel="noopener" href="http://chaijs.com/">Chai</a>æ˜¯ä¸€ä¸ªå•å…ƒæµ‹è¯•çš„éªŒè¯æ¡†æ¶ï¼Œå®ƒæœ‰3ç§ä¸åŒå½¢å¼çš„æ ¡éªŒï¼šexpectã€shouldå’Œassertã€‚expectå’Œshouldçš„æ–¹å¼è®©å†™å‡ºæ¥çš„æµ‹è¯•ä»£ç æ›´åƒè‡ªç„¶è¯­è¨€ï¼Œè®©ä¸šåŠ¡äººå‘˜ä¹Ÿå¯ä»¥çœ‹æ‡‚ï¼Œè€Œassertæ–¹å¼æ˜¯ä¼ ç»Ÿå•å…ƒæµ‹è¯•æ–­è¨€çš„æ–¹å¼ï¼Œå¦‚æœä»¥å‰ä¹ æƒ¯å†™Javaçš„å•å…ƒæµ‹è¯•ä¼šå¯¹è¿™ç§æ–¹å¼æ¯”è¾ƒç†Ÿæ‚‰ã€‚  </p>
<img src="/images/post/2015-12/chai.png" class="">  
<h2 id="Sinon"><a href="#Sinon" class="headerlink" title="Sinon"></a>Sinon</h2><p><a target="_blank" rel="noopener" href="http://sinonjs.org/">Sinon</a>æ˜¯ä¸€ä¸ªmockæ¡†æ¶ï¼Œç±»ä¼¼Javaçš„mockitoã€‚å®ƒå¯ä»¥å¯¹ä»»ä½•å¯¹è±¡è¿›è¡Œmockï¼Œæ›´é‡è¦çš„æ˜¯å®ƒæä¾›äº†ä¸€äº›å¯¹mockå¯¹è±¡çš„æ ¡éªŒæ–¹æ³•ã€‚  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºmockå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> callback = sinon.<span class="title function_">spy</span>();</span><br><span class="line"><span class="comment">// è°ƒç”¨æµ‹è¯•æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="title function_">once</span>(callback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¡éªŒmockå¯¹è±¡æ˜¯å¦è¢«è°ƒç”¨;</span></span><br><span class="line"><span class="title function_">assert</span>(callback.<span class="property">called</span>);</span><br><span class="line"><span class="comment">// æ ¡éªŒè¢«è°ƒç”¨äº†å¤šå°‘æ¬¡</span></span><br><span class="line"><span class="title function_">assert</span>(callback.<span class="property">calledOnce</span>);</span><br><span class="line">assert.<span class="title function_">equals</span>(callback.<span class="property">callCount</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// æ ¡éªŒè¢«å“ªä¸ªå¯¹è±¡è°ƒç”¨</span></span><br><span class="line"> <span class="title function_">assert</span>(callback.<span class="title function_">calledOn</span>(obj));</span><br><span class="line"><span class="comment">// æ ¡éªŒè¢«è°ƒç”¨æ—¶ä¼ å…¥äº†å“ªäº›å‚æ•°</span></span><br><span class="line"><span class="title function_">assert</span>(callback.<span class="title function_">calledWith</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br></pre></td></tr></table></figure>
<h2 id="Redux-React"><a href="#Redux-React" class="headerlink" title="Redux + React"></a>Redux + React</h2><p>Reactä¸ç”¨ä»‹ç»äº†ï¼Œä»Šå¹´æœ€ç«çš„ä¸€ä¸ªå‰ç«¯æ¡†æ¶ï¼Œè€Œ<a target="_blank" rel="noopener" href="https://github.com/rackt/redux">Redux</a>æ˜¯ä¸€ä¸ªä¼ é€’ã€å¤„ç†stateæ•°æ®çš„JSæ¡†æ¶ï¼Œé…åˆReactå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¤„ç†staetæ•°æ®ï¼Œä»è€Œè¾¾åˆ°é€šè¿‡stateæ§åˆ¶æ¸²æŸ“é¡µé¢çš„ç›®çš„ã€‚ä½œè€…<code>Dan Abramov</code>è‡ªå·±æ‹äº†ä¸€ä¸ªReduxçš„æ•™å­¦è§†é¢‘ï¼Œé‡Œé¢é€šè¿‡ä¸€ä¸ªä¸ªdemoæ¼”ç¤ºäº†å¦‚ä½•å†™reactå’Œreduxï¼Œè§†é¢‘å¯ä»¥è§<a target="_blank" rel="noopener" href="https://egghead.io/series/getting-started-with-redux">è¿™é‡Œ</a>ã€‚  </p>
<p>å¯¹äºReduxå’ŒReactçš„åº”ç”¨ï¼Œæœ€ä¸»è¦çš„ä»£ç æœ‰3ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯actionsï¼Œreducersï¼Œcomponentsã€‚actionsæ˜¯å‘é€ä¸€ä¸ªçŠ¶æ€åˆ°reducersï¼Œreducersæ ¹æ®çŠ¶æ€è¿”å›ä¿®æ”¹åçš„stateï¼Œcomponentsæ¥æ”¶åˆ°stateååˆ·æ–°é¡µé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æµ‹è¯•ä¸»è¦é’ˆå¯¹è¿™3ä¸ªéƒ¨åˆ†ã€‚ </p>
<h3 id="actonsæµ‹è¯•"><a href="#actonsæµ‹è¯•" class="headerlink" title="actonsæµ‹è¯•"></a>actonsæµ‹è¯•</h3><p>actionçš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ï¼Œæ¥æ”¶ä»componentä¼ è¿‡æ¥çš„ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰typeå±æ€§çš„ä¸€ä¸ªå¯¹è±¡ã€‚  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">addTodo</span>(<span class="params">text</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;<span class="attr">type</span>: <span class="variable constant_">ADD_TODO</span>, text&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>actionsçš„æµ‹è¯•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œæµ‹è¯•ä»£ç å¯ä»¥è¿™æ ·å†™ï¼š  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;expect&#125; <span class="keyword">from</span> <span class="string">&#x27;chai&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actions <span class="keyword">from</span> <span class="string">&#x27;actions/todos&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;todo actions&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;add todo should create ADD_TODO action&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(actions.<span class="title function_">addTodo</span>(<span class="string">&#x27;Use Redux&#x27;</span>)).<span class="property">to</span>.<span class="property">deep</span>.<span class="title function_">equal</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;add_todo&#x27;</span>,</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;Use Redux&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä½¿ç”¨äº†chaiçš„expectæ ¡éªŒæ–¹å¼ï¼Œä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒéªŒè¯æ˜¯å¦è¿”å›æ­£ç¡®çš„å¯¹è±¡ï¼Œè¿™é‡Œä½¿ç”¨äº†<code>to.deep.equal</code>è¿™ä¸ªæ ¡éªŒæ–¹æ³•ï¼Œå¯ä»¥æ ¡éªŒå¯¹è±¡çš„å±æ€§æ˜¯å¦ç›¸ç­‰ï¼Œè€Œå¯¹äºnumberã€boolç­‰åŸºæœ¬ç±»å‹çš„æ ¡éªŒå¯ä»¥ä½¿ç”¨<code>to.be.equal</code>è¿™ä¸ªæ ¡éªŒæ–¹æ³•ã€‚  </p>
<h3 id="reducersæµ‹è¯•"><a href="#reducersæµ‹è¯•" class="headerlink" title="reducersæµ‹è¯•"></a>reducersæµ‹è¯•</h3><p>reducersä»£ç å¦‚ä¸‹ï¼Œåœ¨åŸæ¥çš„stateåŸºç¡€ä¸ŠåŠ ä¸Šä¸€ä¸ªæ–°çš„todoå¯¹è±¡ã€‚  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">todos</span>(<span class="params">state = initState, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="attr">ADD_TODO</span>:</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      ...state,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">text</span>: action.<span class="property">text</span>,</span><br><span class="line">        <span class="attr">completed</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>(),</span><br><span class="line">      &#125;,</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç å¯ä»¥è¿™æ ·å†™ï¼š  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;reducers&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should add todo correctly&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> state = <span class="title function_">todos</span>(&#123;&#125;, &#123;<span class="attr">type</span>: <span class="variable constant_">ADD_TODO</span>, <span class="attr">text</span>: <span class="string">&#x27;foo&#x27;</span>&#125;);</span><br><span class="line">      <span class="title function_">expect</span>(state.<span class="property">length</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="number">1</span>);</span><br><span class="line">      <span class="title function_">expect</span>(state[<span class="number">0</span>].<span class="property">text</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">      <span class="title function_">expect</span>(state[<span class="number">0</span>].<span class="property">completed</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ—¶ä¼ å…¥ä¸€ä¸ªç©ºçš„stateå¯¹è±¡å’Œä¸€ä¸ªactionå¯¹è±¡ï¼ŒéªŒè¯è¿”å›çš„stateæ˜¯å¦å¢åŠ äº†ä¸€ä¸ªtodoå¯¹è±¡ã€‚  </p>
<h3 id="componentsæµ‹è¯•"><a href="#componentsæµ‹è¯•" class="headerlink" title="componentsæµ‹è¯•"></a>componentsæµ‹è¯•</h3><p>componentsçš„æµ‹è¯•æ¯”è¾ƒå¤æ‚ï¼Œé™¤äº†æµ‹è¯•renderåçš„é¡µé¢ï¼Œè¿˜éœ€è¦æµ‹è¯•ä¸€äº›componentçš„DOMæ–¹æ³•ï¼Œæ¯”å¦‚clickï¼Œchangeï¼Œdoubleclickç­‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªHeaderç»„ä»¶ï¼Œå®ƒæœ‰<code>h1</code>å’Œå¦å¤–ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶<code>TodoInput</code>ï¼Œå…¶ä¸­è¿˜æœ‰ä¸€ä¸ª<code>handleSave</code>çš„è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æµ‹è¯•çš„å°±ä¸»è¦æ˜¯renderå’Œè¿™ä¸ªæ–¹æ³•ã€‚  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">PropTypes</span>, <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TodoInput</span> <span class="keyword">from</span> <span class="string">&#x27;./TodoInput&#x27;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Header</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">handleSave</span>(<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (text &amp;&amp; text.<span class="property">length</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">actions</span>.<span class="title function_">addTodo</span>(text);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">header</span> <span class="attr">className</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Todo List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TodoInput</span> <span class="attr">newTodo</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·å½•å…¥...&quot;</span> <span class="attr">onSave</span>=<span class="string">&#123;(text)</span> =&gt;</span> this.handleSave(text)&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Header</span>.<span class="property">propTypes</span> = &#123;</span><br><span class="line">  <span class="attr">actions</span>: <span class="title class_">PropTypes</span>.<span class="property">object</span>.<span class="property">isRequired</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Header</span>;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•Reactçš„componentï¼Œéœ€è¦ç”¨åˆ°reactçš„ä¸€ä¸ªæµ‹è¯•ç»„ä»¶<a target="_blank" rel="noopener" href="https://facebook.github.io/react/docs/test-utils.html">Test Utils</a>ï¼Œåœ¨å†™æµ‹è¯•ä»£ç ä¹‹å‰ï¼Œéœ€è¦å…ˆæ„é€ ç»„ä»¶renderçš„é¡µé¢ï¼Œæ¸²æŸ“é¡µé¢çš„propså‚æ•°å’Œrenderé¡µé¢çš„å¯¹è±¡ï¼Œè¿™äº›åœ¨åé¢çš„æµ‹è¯•ä¸­éå¸¸æœ‰ç”¨ã€‚  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sinon <span class="keyword">from</span> <span class="string">&#x27;sinon&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;expect&#125; <span class="keyword">from</span> <span class="string">&#x27;chai&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TestUtils</span> <span class="keyword">from</span> <span class="string">&#x27;react-addons-test-utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Header</span> <span class="keyword">from</span> <span class="string">&#x27;components/Header&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TodoInput</span> <span class="keyword">from</span> <span class="string">&#x27;components/TodoInput&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> actions = &#123;<span class="attr">addTodo</span>: sinon.<span class="title function_">spy</span>()&#125;;</span><br><span class="line">  <span class="keyword">const</span> props = &#123;<span class="attr">actions</span>: actions&#125;;</span><br><span class="line">  <span class="keyword">const</span> renderer = <span class="title class_">TestUtils</span>.<span class="title function_">createRenderer</span>();</span><br><span class="line">  renderer.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Header</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>);</span><br><span class="line">  <span class="keyword">const</span> output = renderer.<span class="title function_">getRenderOutput</span>();</span><br><span class="line">  <span class="keyword">return</span> &#123;props, output, renderer&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ„é€ å®Œè¿™äº›å¯¹è±¡åï¼Œæˆ‘ä»¬å…ˆå¯¹renderæ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Header&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="title function_">it</span>(<span class="string">&#x27;should render correctly&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; output &#125; = <span class="title function_">setup</span>();</span><br><span class="line"></span><br><span class="line">     <span class="title function_">expect</span>(output.<span class="property">type</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="string">&#x27;header&#x27;</span>);</span><br><span class="line">     <span class="title function_">expect</span>(output.<span class="property">props</span>.<span class="property">className</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="string">&#x27;header&#x27;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">const</span> [ h1, input ] = output.<span class="property">props</span>.<span class="property">children</span>;</span><br><span class="line"></span><br><span class="line">     <span class="title function_">expect</span>(h1.<span class="property">type</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="string">&#x27;h1&#x27;</span>);</span><br><span class="line">     <span class="title function_">expect</span>(h1.<span class="property">props</span>.<span class="property">children</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="string">&#x27;Todo List&#x27;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="title function_">expect</span>(input.<span class="property">type</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="title class_">TodoInput</span>);</span><br><span class="line">     <span class="title function_">expect</span>(input.<span class="property">props</span>.<span class="property">newTodo</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="literal">true</span>);</span><br><span class="line">     <span class="title function_">expect</span>(input.<span class="property">props</span>.<span class="property">placeholder</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="string">&#x27;è¯·å½•å…¥...&#x27;</span>);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæµ‹è¯•componentçš„ç¬¬ä¸€å±‚â€”â€”headerï¼ŒéªŒè¯å…¶typeå’ŒclassNameï¼Œç„¶åé€šè¿‡childrenè·å–å…¶ä¸‹å±‚ç»„ä»¶<code>h1</code>å’Œ<code>TodoInput</code>ï¼Œå†å¯¹è¿™2ä¸ªç»„ä»¶è¿›è¡Œæ ¡éªŒã€‚  </p>
<p>æ¥ç€æµ‹è¯•TodoInputçš„onSaveæ–¹æ³•ï¼Œå®ƒå®é™…è°ƒç”¨çš„æ˜¯<code>handleSave</code>æ–¹æ³•ï¼Œæ–¹æ³•ä¼šåˆ¤æ–­å‚æ•°textçš„é•¿åº¦æ˜¯å¦ä¸º0æ¥å†³å®šæ˜¯å¦è°ƒç”¨actionsçš„addTodoæ–¹æ³•ã€‚  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;should call addTodo if length of text is greater than 0&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; output, props &#125; = <span class="title function_">setup</span>();</span><br><span class="line">  <span class="keyword">const</span> input = output.<span class="property">props</span>.<span class="property">children</span>[<span class="number">1</span>];</span><br><span class="line">  input.<span class="property">props</span>.<span class="title function_">onSave</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="title function_">expect</span>(props.<span class="property">actions</span>.<span class="property">addTodo</span>.<span class="property">callCount</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="number">0</span>);</span><br><span class="line">  input.<span class="property">props</span>.<span class="title function_">onSave</span>(<span class="string">&#x27;Use Redux&#x27;</span>);</span><br><span class="line">  <span class="title function_">expect</span>(props.<span class="property">actions</span>.<span class="property">addTodo</span>.<span class="property">callCount</span>).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">equal</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä½¿ç”¨sinonæŠŠactionçš„addTodoæ–¹æ³•mockæ‰äº†ï¼Œç„¶åå†éªŒè¯è¯¥æ–¹æ³•æ˜¯å¦æœ‰è°ƒç”¨ã€‚  </p>
<h2 id="Reactç»„ä»¶ä½¿ç”¨äº†CSSæ–‡ä»¶"><a href="#Reactç»„ä»¶ä½¿ç”¨äº†CSSæ–‡ä»¶" class="headerlink" title="Reactç»„ä»¶ä½¿ç”¨äº†CSSæ–‡ä»¶"></a>Reactç»„ä»¶ä½¿ç”¨äº†CSSæ–‡ä»¶</h2><p>åœ¨å†™Reactçš„componentsæ—¶å¯èƒ½ä¼šåŠ ä¸Šè‡ªå·±å®šä¹‰çš„ä¸€äº›cssæ–‡ä»¶ï¼ˆæˆ–è€…æ˜¯lesså’Œsassç­‰ï¼‰ï¼Œè¿™åœ¨mochaè¿è¡Œæµ‹è¯•æ—¶ä¼šæŠ¥é”™ï¼ŒæŠ¥æ— æ³•è§£æcssè¯­æ³•çš„é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™è‡ªå®šä¹‰çš„mocha cssç¼–è¯‘å™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚  </p>
<figure class="highlight js"><figcaption><span>css-null-compiler.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">noop</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>.<span class="property">extensions</span>[<span class="string">&#x27;.styl&#x27;</span>] = noop;</span><br><span class="line"><span class="comment">// you can add whatever you wanna handle</span></span><br><span class="line"><span class="built_in">require</span>.<span class="property">extensions</span>[<span class="string">&#x27;.scss&#x27;</span>] = noop;</span><br><span class="line"><span class="built_in">require</span>.<span class="property">extensions</span>[<span class="string">&#x27;.css&#x27;</span>] = noop;</span><br><span class="line"><span class="comment">// ..etc</span></span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨è¿è¡Œmochaæ—¶åŠ ä¸Šåˆšå†™çš„ç¼–è¯‘å™¨ï¼š<code>mocha /your/test.spec.js --compilers css:css-null-compiler.js</code>ã€‚  </p>
<h2 id="webpackä½¿ç”¨äº†alias"><a href="#webpackä½¿ç”¨äº†alias" class="headerlink" title="webpackä½¿ç”¨äº†alias"></a>webpackä½¿ç”¨äº†alias</h2><p>åœ¨ä½¿ç”¨webpackæ—¶æˆ‘ä»¬ä¼šé€šè¿‡åˆ«åï¼ˆaliasï¼‰çš„æ–¹æ³•æ¥ç®€åŒ–æˆ‘ä»¬importå…¶ä»–æ–‡ä»¶æ—¶çš„è·¯å¾„ï¼Œæ¯”å¦‚åŸæ¥importæ—¶éœ€è¦è¿™æ ·å†™ï¼š  </p>
<figure class="highlight js"><figcaption><span>css-null-compiler.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Header</span> <span class="keyword">from</span> <span class="string">&#x27;../../src/components/Header&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨äº†aliasä¹‹åå¯ä»¥è¿™æ ·ï¼š  </p>
<figure class="highlight js"><figcaption><span>css-null-compiler.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Header</span> <span class="keyword">from</span> <span class="string">&#x27;src/components/Header&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™ç§è·¯å¾„åœ¨æµ‹è¯•çš„æ—¶å€™å°±ä¼šæŠ¥æ‰¾ä¸åˆ°æ–‡ä»¶è·¯å¾„çš„é”™è¯¯ï¼Œå› ä¸ºç›´æ¥ä½¿ç”¨Mochaè¿è¡Œæµ‹è¯•æ—¶å¹¶æ²¡æœ‰è®¾ç½®è·¯å¾„åˆ«åã€‚  </p>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨å‡ ä¸ªå·¥å…·æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆ†åˆ«æ˜¯<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/mock-require">mock-require</a>å’Œ<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/proxyquire">proxyquire</a>ã€‚  </p>
<p>é¦–å…ˆåœ¨mochaçš„beforeæ–¹æ³•ä¸­é€šè¿‡mock-requireæ¥æ›¿æ¢åˆ«åè·¯å¾„ï¼Œç„¶ååœ¨mochaçš„beforeEachä¸­ç”¨proxyquireæ¥è°ƒç”¨è¢«æµ‹è¯•çš„moduleï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š  </p>
<figure class="highlight js"><figcaption><span>css-null-compiler.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> proxyquire <span class="keyword">from</span> <span class="string">&#x27;proxyquire&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> mockrequire <span class="keyword">from</span> <span class="string">&#x27;mock-require&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">before</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// mock the alias path, point to the actual path</span></span><br><span class="line">  <span class="title function_">mockrequire</span>(<span class="string">&#x27;actions/youractions&#x27;</span>, <span class="string">&#x27;your/actual/action/path/from/your/test/file&#x27;</span>);</span><br><span class="line">  <span class="comment">// or mock with a function</span></span><br><span class="line">  <span class="title function_">mockrequire</span>(<span class="string">&#x27;actions/youractions&#x27;</span>, &#123;<span class="attr">actionMethod</span>: <span class="function">() =&gt;</span> &#123;...&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app;</span><br><span class="line"><span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  app = <span class="title function_">proxyquire</span>(<span class="string">&#x27;./app&#x27;</span>, &#123;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//test code</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;xxx&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;xxxx&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Reactçš„ç»„ä»¶ä¸­ä½¿ç”¨äº†DOMå˜é‡"><a href="#Reactçš„ç»„ä»¶ä¸­ä½¿ç”¨äº†DOMå˜é‡" class="headerlink" title="Reactçš„ç»„ä»¶ä¸­ä½¿ç”¨äº†DOMå˜é‡"></a>Reactçš„ç»„ä»¶ä¸­ä½¿ç”¨äº†DOMå˜é‡</h2><p>åœ¨åšcomponentsæµ‹è¯•æ—¶è¿˜ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚åœ¨æŸäº›ç»„ä»¶ä¸­ä½¿ç”¨äº†DOMçš„ä¸€äº›å…¨å±€å˜é‡ï¼Œæ¯”å¦‚<code>window</code>ï¼Œ<code>document</code>ç­‰ï¼Œè¿™äº›åªæœ‰åœ¨æµè§ˆå™¨ä¸­æ‰ä¼šæœ‰ï¼Œè€Œmochaæµ‹è¯•æˆ‘ä»¬æ˜¯åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰æµè§ˆå™¨çš„è¿™äº›å˜é‡ã€‚  </p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜æœ‰2ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨<a target="_blank" rel="noopener" href="http://karma-runner.github.io/0.13/index.html">Karma</a>æ¥åšå•å…ƒæµ‹è¯•ã€‚Karmaæ˜¯ä¸€ä¸ªæµ‹è¯•è¿è¡Œå™¨ï¼Œå®ƒä¼šå¯åŠ¨ä¸€ä¸ªæµè§ˆå™¨æ¥è¿è¡Œæµ‹è¯•ï¼Œæ¯”è¾ƒé€‚åˆç«¯åˆ°ç«¯çš„é¡µé¢æµ‹è¯•ã€‚ä½†å•å…ƒæµ‹è¯•è¦ä½¿ç”¨æµè§ˆå™¨æ¥è¿è¡Œå°±æ˜¾å¾—æœ‰ç‚¹æµªè´¹äº†ï¼Œè€Œä¸”ä¼šå½±å“æµ‹è¯•çš„é€Ÿåº¦ã€‚  </p>
<p>æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/tmpvar/jsdom">jsdom</a>æ¥æ¨¡æ‹ŸDOMç»“æ„ï¼Œé¦–å…ˆæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªjsæ–‡ä»¶æ¥æ¨¡æ‹ŸDOMã€‚  </p>
<figure class="highlight js"><figcaption><span>dom.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jsdom <span class="keyword">from</span> <span class="string">&#x27;jsdom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> mockrequire <span class="keyword">from</span> <span class="string">&#x27;mock-require&#x27;</span>;</span><br><span class="line"><span class="comment">// setup the simplest document possible</span></span><br><span class="line"><span class="keyword">const</span> doc = jsdom.<span class="title function_">jsdom</span>(<span class="string">&#x27;&lt;!doctype html&gt;&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;&#x27;</span>);</span><br><span class="line"><span class="comment">// get the window object out of the document</span></span><br><span class="line"><span class="keyword">const</span> win = doc.<span class="property">defaultView</span>;</span><br><span class="line"><span class="comment">// set globals for mocha that make access to document and window feel</span></span><br><span class="line"><span class="comment">// natural in the test environment</span></span><br><span class="line"><span class="variable language_">global</span>.<span class="property">document</span> = doc;</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">window</span> = win;</span><br><span class="line"><span class="comment">// from mocha-jsdom https://github.com/rstacruz/mocha-jsdom/blob/master/index.js#L80</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">propagateToGlobal</span>(<span class="params"><span class="variable language_">window</span></span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="variable language_">window</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="title function_">hasOwnProperty</span>(key)) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> (key <span class="keyword">in</span> <span class="variable language_">global</span>) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="variable language_">global</span>[key] = <span class="variable language_">window</span>[key];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">matchMedia</span> = <span class="variable language_">window</span>.<span class="property">matchMedia</span> || <span class="keyword">function</span> <span class="title function_">matchMedia</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">matches</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">addListener</span>: <span class="function">() =&gt;</span> &#123;&#125;,</span><br><span class="line">      <span class="attr">removeListener</span>: <span class="function">() =&gt;</span> &#123;&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">propagateToGlobal</span>(win);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨<code>mocha.opts</code>æ–‡ä»¶ä¸­åŠ å…¥å¯¹è¿™ä¸ªæ–‡ä»¶çš„å¼•ç”¨ï¼Œ<code>mocha.opts</code>æ–‡ä»¶æ˜¯mochaçš„é…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬æ”¾åœ¨testç›®å½•ä¸‹é¢ï¼Œé€šè¿‡é…ç½®è¯¥æ–‡ä»¶å¯ä»¥åœ¨è°ƒç”¨mochaå‘½ä»¤æ—¶å°‘å†™ä¸€äº›å‚æ•°ã€‚  </p>
<figure class="highlight js"><figcaption><span>dom.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--<span class="built_in">require</span> test/dom.<span class="property">js</span> </span><br><span class="line">--reporter dot</span><br><span class="line">--ui bdd</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä»¥ååœ¨è¿è¡Œmochaæ—¶å°±ä¼šè‡ªåŠ¨åŠ è½½<code>dom.js</code>æ–‡ä»¶äº†ã€‚  </p>
</div>

</article>
<section id="appreciates">
  <center>
	<h2>èµèµ</h2>
    <div class="post-footer">
      <div>
	    <h4>å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå¯ä»¥æèµ æˆ‘å–æ¯å’–å•¡ğŸ˜Œï¼Œæèµ æ–¹å¼ï¼š</h4>
        <div class="digital-wallet">
          <h6>BTC åœ°å€ï¼š3LYgSyf7ddMALwGWPQr3PY4wzjsTDdg1oV</h6>
          <h6>ETH åœ°å€ï¼š0x0C9b27c89A61aadb0aEC24CA8949910Cbf77Aa73</h6>
        </div>
        <div class="wechat_appreciates">
          <img src="/images/wechat_appreciates.png" alt="qrcode" width="250" >
        </div>
      </div>
      <div>
	    <h4>æ–‡ç« å·²åŒæ­¥æ›´æ–°å…¬ä¼—å·ï¼Œæ¬¢è¿å…³æ³¨</h4>
        <div class="wechat_appreciates">
          <img src="/images/wxgzh_qrcode.jpg" alt="qrcode" width="250" >
        </div>
      </div>
    </div>
  </center>
</section>



    
      <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = 'https://zhaozhiming.github.io/2015/12/19/use-mocha-and-chai-and-sinon-to-test-react-and-redux-webapp/';
            this.page.identifier = 'https://zhaozhiming.github.io/2015/12/19/use-mocha-and-chai-and-sinon-to-test-react-and-redux-webapp/';
        };

        (function() {
          var d = document, s = d.createElement('script');
          s.src = '//zhaozhiming.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

</div>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2024

    èµµèŠæ˜
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a target="_blank" rel="noopener" href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a target="_blank" rel="noopener" href="http://github.com/panks/fabric">fabric</a> by <a target="_blank" rel="noopener" href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5608723650603289" crossorigin="anonymous"></script>
</body>
</html>
