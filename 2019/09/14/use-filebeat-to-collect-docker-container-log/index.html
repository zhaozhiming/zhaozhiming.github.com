<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>ä½¿ç”¨ Filebeat æ”¶é›† Docker å®¹å™¨æ—¥å¿— - Hacker and Geeker&#39;s Way</title>
    <meta name="author" content="">
    
	<meta name="description" content="ä½¿ç”¨ Filebeat æ”¶é›† Docker å®¹å™¨æ—¥å¿—"> <!-- TODO: truncate -->
	<meta name="keywords" content="filebeat,docker,elasticsearch,kibana">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="Hacker and Geeker&#39;s Way" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='/stylesheets/font.css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Amethysta+One' rel='stylesheet' type='text/css'>
	  <script src="/javascripts/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-100485541-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Hacker and Geeker&#39;s Way
    </div>
</h1>
<span class="subtitle"></span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a target="_blank" rel="noopener" href="https://github.com/zhaozhiming" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.twitter.com/kingzzm" class="twitter" title="Twitter"></a>
  </li>
  
  
  <!-- LinkedIn -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.linkedin.com/in/zhaozhiming" class="linkedin" title="LinkedIn"></a>
  </li>
  
  
  
  
  
  <!-- Stackoverflow -->
  <li>
  <a target="_blank" rel="noopener" href="http://stackoverflow.com/users/1954315/zhaozhiming" class="stackoverflow" title="Stackoverflow"></a>
  </li>
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li><a href="/about/index.html">About</a></li>
    
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="https://zhaozhiming.github.io" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>


<div id="toload">
<!-- begin toload -->
    <div id="content">
        <div class="inner">
<article class="post">
	<h2 class="title">ä½¿ç”¨ Filebeat æ”¶é›† Docker å®¹å™¨æ—¥å¿—</h2>
    <div class="meta">
        <div class="date">Published on: <time datetime="2019-09-14T02:53:00.000Z" itemprop="datePublished">9æœˆ 14, 2019</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/docker/">docker</a> <a href="/tags/filebeat/">filebeat</a> <a href="/tags/elasticsearch/">elasticsearch</a> <a href="/tags/kibana/">kibana</a>
</div>
    </div>
	<div class="entry-content"><img src="/images/post/2019/09/log-collect.png" class="" width="400" height="300">

<p>é—®é¢˜ï¼šå¼€å‘äººå‘˜æŸ¥çœ‹æµ‹è¯•ç¯å¢ƒæˆ–è€…ç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿—éå¸¸ä¸æ–¹ä¾¿ï¼Œå› ä¸ºæˆ‘ä»¬æœåŠ¡éƒ½æ˜¯ç”¨ Docker éƒ¨ç½²çš„ï¼Œæ‰€ä»¥å¼€å‘äººå‘˜éœ€è¦å…ˆç™»å½•åˆ°æœåŠ¡å™¨ï¼Œç„¶åå†ç™»å½•åˆ°æŸä¸ª Docker å®¹å™¨æ‰èƒ½çœ‹åˆ°æ—¥å¿—ã€‚</p>
<p>è§£å†³åŠæ³•ï¼šæ­å»ºä¸€å¥—æ—¥å¿—å¯è§†åŒ–ç¯å¢ƒï¼Œè®©å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æµè§ˆå™¨ç›´æ¥æŸ¥çœ‹ç³»ç»Ÿå„ä¸ªæœåŠ¡çš„æ—¥å¿—ã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Filebeat æ¥æ”¶é›† Docker å®¹å™¨æ—¥å¿—ï¼Œå¹¶å°†æ—¥å¿—å­˜å…¥ Elasticsearchï¼Œå†é€šè¿‡ Kibana æ¥å±•ç¤ºã€‚</p>
<span id="more"></span>

<h2 id="Filebeat-vs-LogStash"><a href="#Filebeat-vs-LogStash" class="headerlink" title="Filebeat vs. LogStash"></a>Filebeat vs. LogStash</h2><p><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/products/beats/filebeat">Filebeat</a> æ˜¯<code>Elastic</code>å…¬å¸çš„ä¸€ä¸ªè½»é‡å‹æ—¥å¿—é‡‡é›†å™¨ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä»£æ›¿è¯¥å…¬å¸æ——ä¸‹çš„ <a target="_blank" rel="noopener" href="https://www.elastic.co/cn/products/logstash">Logstash</a>ï¼Œä¹Ÿå¯ä»¥å’Œ Logstash é…åˆä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>Filebeat å’Œ LogStash ç›¸æ¯”ååˆ†è½»é‡ï¼Œä½“ç§¯åªæœ‰ 30 å¤š Mï¼Œå ç”¨çš„èµ„æºè¾ƒä½ï¼Œå®‰è£…ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥åœ¨æ¯ä¸ªéœ€è¦æ”¶é›†æ—¥å¿—çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½²è¿è¡Œã€‚</p>
<p>Filebeat å°†æ›´å¤šèƒ½åŠ›æ”¾åœ¨äº†æ•°æ®<code>æ”¶é›†</code>ä¸Šé¢ï¼Œè€Œ Logstash æ›´å¤šçš„èƒ½åŠ›æ˜¯ä½“ç°åœ¨æ•°æ®çš„<code>è¿‡æ»¤</code>å’Œ<code>è½¬æ¢</code>ä¸Šã€‚</p>
<h2 id="EFK-å®‰è£…"><a href="#EFK-å®‰è£…" class="headerlink" title="EFK å®‰è£…"></a>EFK å®‰è£…</h2><p>ElasticSearch å’Œ Kibana çš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ç›´æ¥ç”¨ Docker å®‰è£…çš„æ–¹å¼ï¼Œä½†è¦æ³¨æ„ Elasticsearch å’Œ Kibana çš„ç‰ˆæœ¬éœ€è¦ä¿æŒä¸€è‡´ï¼Œä¸ç„¶ Kibana å¯èƒ½å¯åŠ¨ä¸èµ·æ¥ã€‚</p>
<p>Filebeat çš„å®‰è£…æ–¹å¼æœ‰å¤šç§ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½å®‰è£…ç¨‹åºå®‰è£…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Docker æ–¹å¼å®‰è£…ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name=filebeat \</span><br><span class="line">  --user=root \</span><br><span class="line">  --volume=<span class="string">&quot;<span class="subst">$(pwd)</span>/filebeat.docker.yml:/usr/share/filebeat/filebeat.yml:ro&quot;</span> \</span><br><span class="line">  --volume=<span class="string">&quot;/var/lib/docker/containers:/var/lib/docker/containers:ro&quot;</span> \</span><br><span class="line">  --volume=<span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;</span> \</span><br><span class="line">  docker.elastic.co/beats/filebeat:7.3.1 filebeat -e -strict.perms=<span class="literal">false</span> \</span><br><span class="line">  -E output.elasticsearch.hosts=[<span class="string">&quot;localhost:9200&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™é‡Œæ˜ å°„äº† Filebeat é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼ŒåŒæ—¶æ˜ å°„äº† Docker å®¹å™¨çš„æ–‡ä»¶è·¯å¾„ã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ Docker-compose æ¥å¯åŠ¨ Filebeatï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">filebeat:</span><br><span class="line">    image: docker.elastic.co/beats/filebeat:7.3.1</span><br><span class="line">    user: root</span><br><span class="line">    <span class="built_in">command</span>: filebeat -e -strict.perms=<span class="literal">false</span></span><br><span class="line">    volumes:</span><br><span class="line">      - ./filebeat/filebeat.docker.yml:/usr/share/filebeat/filebeat.yml:ro</span><br><span class="line">      - /var/lib/docker/containers:/var/lib/docker/containers:ro</span><br><span class="line">      - /var/run/docker.sock:/var/run/docker.sock:ro</span><br><span class="line">    restart: always</span><br><span class="line">    links:</span><br><span class="line">      - elasticsearch</span><br></pre></td></tr></table></figure>

<h2 id="åŸºäº-Docker-çš„-Filebeat-é…ç½®"><a href="#åŸºäº-Docker-çš„-Filebeat-é…ç½®" class="headerlink" title="åŸºäº Docker çš„ Filebeat é…ç½®"></a>åŸºäº Docker çš„ Filebeat é…ç½®</h2><p>ä½¿ç”¨å®˜æ–¹æ¨èçš„è¿™ä¸ªé…ç½®æ¨¡æ¿å°±å¤Ÿäº†ï¼Œæˆ‘ä»¬å¯¹ Filebeat çš„é…ç½®ä¸»è¦ä½“ç°åœ¨å…·ä½“çš„å®¹å™¨ä¸Šï¼Œè€Œä¸æ˜¯ Filebeat æœ¬èº«ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ä¸‹è½½ filebeat é…ç½®æ–‡ä»¶</span></span><br><span class="line">curl -L -O https://raw.githubusercontent.com/elastic/beats/7.3/deploy/docker/filebeat.docker.yml</span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶å†…å®¹æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filebeat.config:</span></span><br><span class="line">  <span class="attr">modules:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">$&#123;path.config&#125;/modules.d/*.yml</span></span><br><span class="line">    <span class="attr">reload.enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">filebeat.autodiscover:</span></span><br><span class="line">  <span class="attr">providers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">docker</span></span><br><span class="line">      <span class="attr">hints.enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">add_cloud_metadata:</span> <span class="string">~</span></span><br><span class="line"></span><br><span class="line"><span class="attr">output.elasticsearch:</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">&#x27;$&#123;ELASTICSEARCH_HOSTS:elasticsearch:9200&#125;&#x27;</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">&#x27;$&#123;ELASTICSEARCH_USERNAME:&#125;&#x27;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&#x27;$&#123;ELASTICSEARCH_PASSWORD:&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="è¿‡æ»¤ä¸éœ€è¦æ”¶é›†æ—¥å¿—çš„-Docker-å®¹å™¨"><a href="#è¿‡æ»¤ä¸éœ€è¦æ”¶é›†æ—¥å¿—çš„-Docker-å®¹å™¨" class="headerlink" title="è¿‡æ»¤ä¸éœ€è¦æ”¶é›†æ—¥å¿—çš„ Docker å®¹å™¨"></a>è¿‡æ»¤ä¸éœ€è¦æ”¶é›†æ—¥å¿—çš„ Docker å®¹å™¨</h2><p>æŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„æ–¹å¼å¯åŠ¨ Filebeat åï¼ŒFilebeat ä¼šè‡ªåŠ¨æ”¶é›†æœºå™¨ä¸Šæ‰€æœ‰ Docker å®¹å™¨çš„æ—¥å¿—ï¼ŒåŒ…æ‹¬ Elasticsearchï¼ŒKibanaï¼ŒFilebeat è¿™äº›å·¥å…·å®¹å™¨çš„æ—¥å¿—ï¼Œä½†è¿™äº›æ—¥å¿—å¯èƒ½ä¸æ˜¯æˆ‘ä»¬æ‰€å…³å¿ƒçš„ï¼Œæˆ‘ä»¬ä¸æƒ³è®© Filebeat æ”¶é›†è¿™äº›å®¹å™¨çš„æ—¥å¿—ã€‚</p>
<p>Filebeat æä¾›äº†ä¸€äº› Docker æ ‡ç­¾ï¼ˆLabelï¼‰ï¼Œå¯ä»¥è®© Docker å®¹å™¨åœ¨ Filebeat çš„<code>autodiscover</code>é˜¶æ®µå¯¹æ—¥å¿—è¿›è¡Œè¿‡æ»¤å’ŒåŠ å·¥ï¼Œå…¶ä¸­æœ‰ä¸ªæ ‡ç­¾å°±æ˜¯å¯ä»¥è®©æŸä¸ªå®¹å™¨çš„æ—¥å¿—ä¸è¿›å…¥ Filebeatï¼š</p>
<ul>
<li>co.elastic.logs&#x2F;enabled: æ—¥å¿—æ”¶é›†åŠŸèƒ½æ˜¯å¦å¯åŠ¨æ ‡å¿—ï¼Œé»˜è®¤å€¼ä¸º<code>true</code>ï¼Œè®¾ä¸º<code>false</code>å³ä¸ºä¸æ”¶é›†æ—¥å¿—ã€‚</li>
</ul>
<p>å¯ä»¥åœ¨<code>docker run</code>çš„æ—¶å€™åŠ ä¸Šè¿™ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --label co.elastic.logs/enabled=<span class="literal">false</span> ...</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æ˜¯ç”¨ Docker-compose å¯åŠ¨çš„è¯ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filebeat:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/beats/filebeat:7.3.1</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">co.elastic.logs/enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶æ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨ Filebeat çš„é…ç½®æ–‡ä»¶é‡Œé¢é…ç½®éœ€è¦æ”¶é›†æ—¥å¿—çš„å®¹å™¨ï¼Œä½†è¯•äº†å‡ æ¬¡æ²¡æ‰¾åˆ°å¯ä»¥è®©é…ç½®ç”Ÿæ•ˆçš„å†™æ³•ï¼Œå¦‚æœæœ‰äººçŸ¥é“å¦‚ä½•é…ç½®ï¼Œä¹Ÿè¯·ç•™è¨€å‘ŠçŸ¥ï¼Œè°¢è°¢ã€‚</p>
<h2 id="ç»Ÿä¸€æ”¶é›†å®¹å™¨ä¸­å…¶ä»–è·¯å¾„çš„æ—¥å¿—"><a href="#ç»Ÿä¸€æ”¶é›†å®¹å™¨ä¸­å…¶ä»–è·¯å¾„çš„æ—¥å¿—" class="headerlink" title="ç»Ÿä¸€æ”¶é›†å®¹å™¨ä¸­å…¶ä»–è·¯å¾„çš„æ—¥å¿—"></a>ç»Ÿä¸€æ”¶é›†å®¹å™¨ä¸­å…¶ä»–è·¯å¾„çš„æ—¥å¿—</h2><p>Filebeat é»˜è®¤æ”¶é›†çš„æ˜¯ Docker å®¹å™¨å¯åŠ¨åè¾“å‡ºåˆ°<code>docker logs</code>çš„æ—¥å¿—ï¼Œä½†æœ‰äº›æœåŠ¡é™¤äº†è¿™äº›æ—¥å¿—å¤–ï¼Œè¿˜ä¼šæŠŠå…¶ä»–æ—¥å¿—å­˜æ”¾åˆ°å®¹å™¨çš„é‡Œé¢ã€‚æ¯”å¦‚<code>egg.js</code>æ¡†æ¶ä¼šæŠŠé”™è¯¯æ—¥å¿—å’Œä¸€äº› web æ—¥å¿—æ”¾åˆ°<code>/root/logs/yourserver/</code>ä¸‹é¢ã€‚é‚£ä¹ˆè¦å¦‚ä½•æ”¶é›†è¿™äº›é¢å¤–çš„æ—¥å¿—å‘¢ï¼Ÿ</p>
<p>è§£å†³æ–¹æ³•æ˜¯æŠŠé¢å¤–æ—¥å¿—çš„è·¯å¾„æ˜ å°„åˆ° Docker çš„è¾“å‡ºæ§åˆ¶å°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Dockerfile é‡Œé¢è¿™æ ·è®¾ç½®ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æ™®é€šæ—¥å¿—è¾“å‡ºåˆ° stdout</span></span><br><span class="line">RUN <span class="built_in">ln</span> -sf /dev/stdout /root/logs/web-server/web-server-web.log</span><br><span class="line"><span class="comment"># å°†é”™è¯¯æ—¥å¿—è¾“å‡ºåˆ° stderr</span></span><br><span class="line">RUN <span class="built_in">ln</span> -sf /dev/stderr /root/logs/web-server/common-error.log</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å®¹å™¨å¯åŠ¨åå°±ä¼šå°†å®¹å™¨é‡Œæ—¥å¿—ä¼ è¾“åˆ°æ§åˆ¶å°ä¸Šï¼Œè€Œ Filebeat ä¹Ÿå°±å¯ä»¥æ”¶é›†è¯¥æ—¥å¿—äº†ã€‚</p>
<h2 id="è§£å†³å¤šè¡Œæ—¥å¿—é—®é¢˜"><a href="#è§£å†³å¤šè¡Œæ—¥å¿—é—®é¢˜" class="headerlink" title="è§£å†³å¤šè¡Œæ—¥å¿—é—®é¢˜"></a>è§£å†³å¤šè¡Œæ—¥å¿—é—®é¢˜</h2><p>Filebeat æ”¶é›†æ—¥å¿—åå°†å…¶å­˜å…¥åˆ° Elasticsearchï¼Œé»˜è®¤çš„å­˜å‚¨è§„åˆ™æ˜¯ä¸€è¡Œæ—¥å¿—ä½œä¸º Elasticsearch çš„ä¸€æ¡è®°å½•ï¼Œä½†åƒé”™è¯¯ä¿¡æ¯è¿™ç§æ—¥å¿—ä¼šå‡ºç°å¤šè¡Œçš„æƒ…å†µï¼Œå¦‚æœåŒä¸€ä¸ªæ—¥å¿—åˆ†æˆå¤šè¡Œçš„è¯æŸ¥çœ‹èµ·æ¥å°±ä¸å¤ªæ–¹ä¾¿ï¼Œå› ä¸ºä¸­é—´å¯èƒ½è¢«å…¶ä»–æ—¥å¿—æ‰“æ–­ï¼Œè€Œä¸”æœç´¢çš„æ—¶å€™ä¹Ÿä¸èƒ½æŠŠåŒä¸€ä¸ªé”™è¯¯çš„æ—¥å¿—ä¸€å¹¶æŸ¥è¯¢å‡ºæ¥ï¼Œæ‰€ä»¥æœ€å¥½çš„æ–¹å¼æ˜¯èƒ½å°†åŒä¸€ä¸ªé”™è¯¯çš„å¤šè¡Œæ—¥å¿—å­˜å…¥ Elasticsearch çš„åŒä¸€æ¡è®°å½•ã€‚</p>
<p>Filebeat è€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µï¼Œè®©æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ å®¹å™¨ä¾¿ç­¾çš„æ–¹å¼æ¥è®¾ç½®å¤šè¡Œæ—¥å¿—çš„æ•´åˆè§„åˆ™ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æ¯æ¡æ—¥å¿—éƒ½æ˜¯ä»¥æ—¶é—´æ ¼å¼å¼€å§‹çš„ï¼š<code>2019-01-01 11:11:11,1111 xxxx</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å¤šè¡Œè®¾ç½®è§„åˆ™å°±å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">web-server-dev:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">co.elastic.logs/multiline.pattern:</span> <span class="string">&#x27;^\d&#123;4&#125;-\d&#123;2&#125;-\d&#123;2&#125;\s\d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;,\d&#123;3&#125;\s&#x27;</span></span><br><span class="line">      <span class="attr">co.elastic.logs/multiline.negate:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">co.elastic.logs/multiline.match:</span> <span class="string">after</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ pattern è¡¨ç¤ºæ—¥å¿—å†…å®¹å¦‚æœä¸åŒ¹é…è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼åˆ™ä¸èƒ½ä½œä¸ºæ–°çš„ä¸€è¡Œæ—¥å¿—ï¼Œè¿™æ ·æ—¥å¿—å°±ä¼šæŒ‰ç…§æ—¶é—´è¿›è¡Œåˆ†ç»„äº†ã€‚</p>
<h2 id="Kibana-å»ºç«‹å¯¹åº”æœåŠ¡çš„æœç´¢"><a href="#Kibana-å»ºç«‹å¯¹åº”æœåŠ¡çš„æœç´¢" class="headerlink" title="Kibana å»ºç«‹å¯¹åº”æœåŠ¡çš„æœç´¢"></a>Kibana å»ºç«‹å¯¹åº”æœåŠ¡çš„æœç´¢</h2><p>Filebeat å°†æ—¥å¿—å­˜å…¥åˆ° Elasticsearch åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Kibana æ¥æŸ¥çœ‹æ—¥å¿—äº†ã€‚åœ¨ Kibana ä¸­åˆ›å»ºä»¥<code>filebeat-*</code>å¼€å¤´çš„ç´¢å¼•ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä»¥<code>filebeat</code>å¼€å¤´çš„ç´¢å¼•ï¼Œè¿™æ˜¯ Filebeat å¯¼å…¥æ—¥å¿—çš„ç´¢å¼•ï¼Œæ¯å¤©ä¼šäº§ç”Ÿè¿™æ ·çš„ä¸€ä¸ªç´¢å¼•ã€‚</p>
<p>åˆ›å»ºå®Œç´¢å¼•åå¯ä»¥é€šè¿‡ä¸€äº› Docker çš„æŸ¥è¯¢æ¡ä»¶æ¥æŸ¥è¯¢æ—¥å¿—ï¼Œæ¯”å¦‚æƒ³æŸ¥è¯¢å®¹å™¨åä¸º<code>foo</code>çš„å®¹å™¨çš„æ—¥å¿—ï¼Œå°±å¯ä»¥ç”¨<code>container.name=foo</code>è¿™æ ·çš„è¿‡æ»¤æ¡ä»¶æ¥æŸ¥è¯¢ï¼Œå¦‚æœæƒ³ä»¥é•œåƒåæ¥æŸ¥è¯¢ä¹Ÿå¯ä»¥ï¼Œç”¨<code>image.name=xxx</code>çš„æŸ¥è¯¢æ¡ä»¶å°±å¯ä»¥æŸ¥è¯¢å‡ºè¯¥é•œåƒçš„æ‰€æœ‰å®¹å™¨çš„æ—¥å¿—ã€‚</p>
<p>å±•ç¤ºå­—æ®µä¸€èˆ¬åªéœ€è¦<code>message</code>å­—æ®µå°±å¯ä»¥äº†ï¼Œä¹Ÿå¯ä»¥è§†æƒ…å†µæ·»åŠ <code>container.name</code>æˆ–<code>image.name</code>ç­‰å­—æ®µã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸Šé¢ä»‹ç»çš„ Filebeat å®˜æ–¹æ¨èçš„ä¸€ç§æ”¶é›† Docker å®¹å™¨çš„æ–¹æ³•ï¼Œå…¶å®è¿˜æœ‰å…¶ä»–æ–¹æ¡ˆï¼Œæ¯”å¦‚è¯´åœ¨æ¯ä¸ªå®¹å™¨é‡Œé¢å®‰è£…ä¸€ä¸ª Filebeat å®¢æˆ·ç«¯æ¥åˆ†åˆ«æ”¶é›†å„è‡ªæœåŠ¡çš„æ—¥å¿—ï¼Œæˆ–è€…æ˜¯æŠŠæ¯ä¸ª Docker å®¹å™¨çš„æ—¥å¿—è·¯å¾„éƒ½æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ä¸‹é¢ï¼Œç„¶ååœ¨å®¿ä¸»æœºä¸Šå®‰è£…ä¸€ä¸ª Filebeat å®¢æˆ·ç«¯æ¥ç»Ÿä¸€æ”¶é›†ã€‚å¦‚æœæ‚¨è¿˜æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œå¸Œæœ›å¯ä»¥ç•™è¨€ä¸€èµ·è®¨è®ºåˆ†äº«ï¼Œè°¢è°¢ã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/config/containers/logging/">è®¿é—® Docker å®¹å™¨æ—¥å¿—</a></li>
</ul>
</div>

</article>
<section id="appreciates">
  <center>
	<h2>èµèµ</h2>
    <div class="post-footer">
      <div>
	    <h4>å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå¯ä»¥æèµ æˆ‘å–æ¯å’–å•¡ğŸ˜Œï¼Œæèµ æ–¹å¼ï¼š</h4>
        <div class="digital-wallet">
          <h6>BTC åœ°å€ï¼š3LYgSyf7ddMALwGWPQr3PY4wzjsTDdg1oV</h6>
          <h6>ETH åœ°å€ï¼š0x0C9b27c89A61aadb0aEC24CA8949910Cbf77Aa73</h6>
        </div>
        <div class="wechat_appreciates">
          <img src="/images/wechat_appreciates.png" alt="qrcode" width="250" >
        </div>
      </div>
      <div>
	    <h4>æ–‡ç« å·²åŒæ­¥æ›´æ–°å…¬ä¼—å·ï¼Œæ¬¢è¿å…³æ³¨</h4>
        <div class="wechat_appreciates">
          <img src="/images/wxgzh_qrcode.jpg" alt="qrcode" width="250" >
        </div>
      </div>
    </div>
  </center>
</section>



    
      <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = 'https://zhaozhiming.github.io/2019/09/14/use-filebeat-to-collect-docker-container-log/';
            this.page.identifier = 'https://zhaozhiming.github.io/2019/09/14/use-filebeat-to-collect-docker-container-log/';
        };

        (function() {
          var d = document, s = d.createElement('script');
          s.src = '//zhaozhiming.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

</div>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2025

    èµµèŠæ˜
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a target="_blank" rel="noopener" href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a target="_blank" rel="noopener" href="http://github.com/panks/fabric">fabric</a> by <a target="_blank" rel="noopener" href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5608723650603289" crossorigin="anonymous"></script>
</body>
</html>
