<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>OpenAI 新版 API 使用介绍 - Hacker and Geeker&#39;s Way</title>
    <meta name="author" content="">
    
	<meta name="description" content="OpenAI 新版 API 使用介绍"> <!-- TODO: truncate -->
	<meta name="keywords" content="openai, chatgpt, api">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="Hacker and Geeker&#39;s Way" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='/stylesheets/font.css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='/stylesheets/font.css?family=Amethysta+One' rel='stylesheet' type='text/css'>
	  <script src="/javascripts/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-100485541-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Hacker and Geeker&#39;s Way
    </div>
</h1>
<span class="subtitle"></span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a target="_blank" rel="noopener" href="https://github.com/zhaozhiming" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.twitter.com/kingzzm" class="twitter" title="Twitter"></a>
  </li>
  
  
  <!-- LinkedIn -->
  <li>
  <a target="_blank" rel="noopener" href="http://www.linkedin.com/in/zhaozhiming" class="linkedin" title="LinkedIn"></a>
  </li>
  
  
  
  
  
  <!-- Stackoverflow -->
  <li>
  <a target="_blank" rel="noopener" href="http://stackoverflow.com/users/1954315/zhaozhiming" class="stackoverflow" title="Stackoverflow"></a>
  </li>
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li><a href="/about/index.html">About</a></li>
    
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="https://zhaozhiming.github.io" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>


<div id="toload">
<!-- begin toload -->
    <div id="content">
        <div class="inner">
<article class="post">
	<h2 class="title">OpenAI 新版 API 使用介绍</h2>
    <div class="meta">
        <div class="date">Published on: <time datetime="2023-11-11T08:03:41.000Z" itemprop="datePublished">11月 11, 2023</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/api/">api</a> <a href="/tags/chatgpt/">chatgpt</a> <a href="/tags/openai/">openai</a>
</div>
    </div>
	<div class="entry-content"><img src="/images/post/2023/11/openai-api.png" class="" width="400" height="300">

<p>OpenAI 最近举办了首次开发者大会，大会上不仅发布了 GPTs 这样<strong>王炸级别的</strong>新功能，还发布了一些新模型，比如<code>gpt-4-turbo</code>等，模型的知识截止时间也提高到了 2023 年 4 月，配合这些新模型，OpenAI 还开放了大家期盼已久的新 API，其中包括语音生成、图像生成、图像识别等功能，本文将对这些新 API 进行介绍，帮助大家快速掌握这些新功能。</p>
<span id="more"></span>

<h2 id="OpenAI-Python-包"><a href="#OpenAI-Python-包" class="headerlink" title="OpenAI Python 包"></a>OpenAI Python 包</h2><p>在 OpenAI 举办完开发者大会后，OpenAI 的官方 Python 包也进行了快速更新，从原来的 0.x 版本一下子升级到 1.x 版本，截止到笔者撰写本文时，最新的版本为 1.2.3。在本文中，我们将使用最新的 Python 包进行演示，大家可以按照以下步骤安装最新的 Python 包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade openai</span><br></pre></td></tr></table></figure>

<p>然后在终端导入 OpenAI 的 API KEY 作为环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> OPENAI_API_KEY=sk-xxxxx</span><br></pre></td></tr></table></figure>

<p>这样我们在使用 OpenAI 的 Python 包时就会自动加载这个环境变量了。</p>
<h2 id="文字转语音"><a href="#文字转语音" class="headerlink" title="文字转语音"></a>文字转语音</h2><p>OpenAI 新版的文字转语音 API 提供了 2 个 TTS（Text to Speech）模型：tts-1 和 tts-1-hd。tts-1 模型速度较快，而 tts-1-hd 模型质量较高，大家可以根据自己的实际需求选择合适的模型，模型的使用方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"></span><br><span class="line">response = openai.audio.speech.create(</span><br><span class="line">    model=<span class="string">&quot;tts-1&quot;</span>,</span><br><span class="line">    voice=<span class="string">&quot;shimmer&quot;</span>,</span><br><span class="line">    <span class="built_in">input</span>=<span class="string">&quot;举头望明月，低头思故乡&quot;</span>,</span><br><span class="line">    response_format=<span class="string">&quot;mp3&quot;</span>,</span><br><span class="line">    speed=<span class="number">1.0</span>,</span><br><span class="line">)</span><br><span class="line">speech_file_path = Path(__file__).parent / <span class="string">&quot;speech.mp3&quot;</span></span><br><span class="line">response.stream_to_file(speech_file_path)</span><br></pre></td></tr></table></figure>

<ul>
<li>model 参数可以选择 tts-1 或者 tts-1-hd。</li>
<li>voice 参数是指声音的类型，目前支持 6 种声音，分别是：alloy、echo、fable、onyx、nova、和 shimmer。</li>
<li>另外 API 还有 2 个可选参数，分别是 response_format 和 speed，response_format 参数是指导出声音文件格式，可以选择 mp3、opus、 aac 和 flac；speed 参数是指声音的速度，值的范围是 0.25 ~ 4.0，默认值是 1.0。</li>
</ul>
<p>下面是 6 种声音的对比，使用的是 tts-1 的模型，对于中文来说效果比较好的是 alloy 的声音，其他的外国腔都比较重。</p>
<h3 id="Alloy"><a href="#Alloy" class="headerlink" title="Alloy"></a>Alloy</h3><audio width="480" height="320" controls>
  <source src="/images/post/2023/11/speech-alloy.mp3" type="audio/mp3">
</audio>

<h3 id="Echo"><a href="#Echo" class="headerlink" title="Echo"></a>Echo</h3><audio width="480" height="320" controls>
  <source src="/images/post/2023/11/speech-echo.mp3" type="audio/mp3">
</audio>

<h3 id="Fable"><a href="#Fable" class="headerlink" title="Fable"></a>Fable</h3><audio width="480" height="320" controls>
  <source src="/images/post/2023/11/speech-fable.mp3" type="audio/mp3">
</audio>

<h3 id="Nova"><a href="#Nova" class="headerlink" title="Nova"></a>Nova</h3><audio width="480" height="320" controls>
  <source src="/images/post/2023/11/speech-nova.mp3" type="audio/mp3">
</audio>

<h3 id="Onyx"><a href="#Onyx" class="headerlink" title="Onyx"></a>Onyx</h3><audio width="480" height="320" controls>
  <source src="/images/post/2023/11/speech-onyx.mp3" type="audio/mp3">
</audio>

<h3 id="Shimmer"><a href="#Shimmer" class="headerlink" title="Shimmer"></a>Shimmer</h3><audio width="480" height="320" controls>
  <source src="/images/post/2023/11/speech-shimmer.mp3" type="audio/mp3">
</audio>

<h2 id="图像生成"><a href="#图像生成" class="headerlink" title="图像生成"></a>图像生成</h2><p>图像生成方面也新推出了可以使用 DALL-E 3 模型的 API，使用方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">client = OpenAI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_image_by_url</span>(<span class="params">url, file_name: <span class="built_in">str</span> = <span class="string">&quot;output.png&quot;</span></span>):</span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(response.content)</span><br><span class="line"></span><br><span class="line">response = client.images.generate(</span><br><span class="line">    model=<span class="string">&quot;dall-e-3&quot;</span>,</span><br><span class="line">    prompt=<span class="string">&quot;画一个宇航员在月球上骑马的图片&quot;</span>,</span><br><span class="line">    n=<span class="number">1</span>,</span><br><span class="line">    quality=<span class="string">&quot;standard&quot;</span>,</span><br><span class="line">    size=<span class="string">&quot;1024x1024&quot;</span>,</span><br><span class="line">    style=<span class="string">&quot;vivid&quot;</span>,</span><br><span class="line">    response_format=<span class="string">&quot;url&quot;</span>,</span><br><span class="line">)</span><br><span class="line">result = json.loads(response.json())</span><br><span class="line">image_url = result[<span class="string">&quot;data&quot;</span>][<span class="number">0</span>][<span class="string">&quot;url&quot;</span>]</span><br><span class="line">save_image_by_url(image_url)</span><br></pre></td></tr></table></figure>

<ul>
<li>model 参数是指使用的模型，可以选择 dall-e-2 或者 dall-e-3。</li>
<li>prompt 参数是指生成图片的提示词，dall-e-2 模型支持 1000 个 token，而 dall-e-3 模型支持 4000 个 token。</li>
<li>n 参数是指一次生成多少张图片，范围为 1 到 10，dall-e-3 模型只能支持一次生成一张图片。</li>
<li>quality 参数是指图片的质量，有 standard 和 hd 两个选项，standard 是标准质量，生成速度较快，hd 是高清质量，生成速度较慢，该参数只对 dall-e-3 模型有效。</li>
<li>size 参数是指图片的尺寸，默认是 1024 x 1024，对于 dall-e-2 模型支持 256x256、512x512、1024x1024 三种尺寸，对于 dall-e-3 模型支持 1024x1024、1792x1024、1024x1792 三种尺寸。</li>
<li>style 参数是生成图片的风格，有 vivid 和 natural 两个选项，vivid 让图片更贴近真实场景，而 natural 让图片更像是绘画。</li>
<li>response_format 是指输出格式，有 url 和 b64_json 两种格式，url 是指输出图片的 url 地址，b64_json 是指输出图片的 base64 编码。</li>
</ul>
<p>上面的例子返回了图片的 url，下面再演示一下通过 b64_json 格式输出图片的 base64 编码，然后再将 base64 编码转换成图片文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_image_by_b64</span>(<span class="params">b64_json: <span class="built_in">str</span>, file_name: <span class="built_in">str</span> = <span class="string">&quot;output.png&quot;</span></span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(base64.b64decode(b64_json))</span><br><span class="line"></span><br><span class="line">response = client.images.generate(</span><br><span class="line">    ......</span><br><span class="line">    response_format=<span class="string">&quot;b64_json&quot;</span>,</span><br><span class="line">)</span><br><span class="line">result = json.loads(response.json())</span><br><span class="line">image_b64 = result[<span class="string">&quot;data&quot;</span>][<span class="number">0</span>][<span class="string">&quot;b64_json&quot;</span>]</span><br><span class="line">save_image_by_b64(image_b64, file_name=<span class="string">&quot;output-b64.png&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>生成的图片效果如下：</p>
<img src="/images/post/2023/11/openai-api-image.png" class="" width="600" height="400">

<h2 id="固定输出-Json-对象"><a href="#固定输出-Json-对象" class="headerlink" title="固定输出 Json 对象"></a>固定输出 Json 对象</h2><p>以前让 ChatGPT 返回 Json 格式的结果时，由于 ChatGPT 喜欢<strong>废话</strong>的特性，返回的结果往往不尽人意，经常是返回一个 Json 对象然后再带上一段废话，这样让我们在程序解析上比较麻烦，现在 OpenAI 新版 API 新增了一个专门返回有效 Json 对象的功能，使用方法如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line">SYSTEM_PROMPT = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">你是一个得力的助手，帮助人类提取句子中的人名信息，并以json格式展示。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">json格式如下：</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;name&quot;: [&quot;小明&quot;],</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">completion = client.chat.completions.create(</span><br><span class="line">    model=<span class="string">&quot;gpt-3.5-turbo-1106&quot;</span>,  <span class="comment"># 需要用到新模型，老的比如 gpt-3.5-turbo 不支持该功能</span></span><br><span class="line">    messages=[</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: SYSTEM_PROMPT&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;小明和小红去上学。&quot;</span>&#125;,</span><br><span class="line">    ],</span><br><span class="line">    response_format=&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;json_object&quot;</span>&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(completion.choices[<span class="number">0</span>].message.content)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用的 API 是对话 API，但不同的地方是，response_format 参数将值设置为<code>&#123;&quot;type&quot;: &quot;json_object&quot;&#125;</code>，这样就启动了 Json 模式，保证了返回的结果是一个 Json 对象。</li>
<li>注意使用 JSON 模式的时候，model 参数需要用到新模型，比如 gpt-3.5-turbo-1106 或 gpt-4-1106-preview，老模型不支持该功能。</li>
<li>还有一点是，使用 JSON 模式时，在提示词中必须明确要求 ChatGPT 返回 Json 格式，不管是在 System 提示词还是 User 提示词中都可以，否则 API 就会返回无限循环的空格，直到 token 达到上限。</li>
</ul>
<p>上面例子的返回内容如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;小明&quot;</span><span class="punctuation">,</span> <span class="string">&quot;小红&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="一次执行多个-Function-Calling"><a href="#一次执行多个-Function-Calling" class="headerlink" title="一次执行多个 Function Calling"></a>一次执行多个 Function Calling</h2><p>Function Calling 是 OpenAI 之前就具备的功能，即在对话中使用用户自定义的工具，来让 ChatGPT 能做更多的事情，比如实时查询某个地区的天气情况，或者查询股票的最新价格等。但是以前在一次对话中只能调用一个工具，现在新版 API 支持一次调用多个工具。</p>
<img src="/images/post/2023/11/openai-api-function-call.png" class="" width="1000" height="600">

<p>下面使用代码分段展示如何在一次对话中调用多个工具：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line">client = OpenAI()</span><br><span class="line"></span><br><span class="line">messages = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: <span class="string">&quot;今天北京、上海、成都的天气怎么样？&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">tools = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">        <span class="string">&quot;function&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;get_current_weather&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;获取某个地方当前的天气情况&quot;</span>,</span><br><span class="line">            <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">                <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;城市名，比如： 北京, 上海&quot;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;location&quot;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">response = client.chat.completions.create(</span><br><span class="line">    model=<span class="string">&quot;gpt-3.5-turbo-1106&quot;</span>,</span><br><span class="line">    messages=messages,</span><br><span class="line">    tools=tools,</span><br><span class="line">    tool_choice=<span class="string">&quot;auto&quot;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>首先使用我们定义了对话中要用到的工具集 tools，ChatGPT 会根据用户的问题来选择调用哪个工具，示例代码中我们用到一个查询天气的工具。</li>
<li>tools 参数以前叫做 functions，现在改名为 tools，但是功能是一样的，都是用来定义工具集的。需要定义工具的名称、描述和参数信息（名称、类型、描述和是否必需）。</li>
<li>model 参数是指使用的模型，一次调用多个工具需要选择新模型： gpt-3.5-turbo-1106 或者 gpt-4-1106-preview。</li>
<li>tool_choice 参数以前叫做 function_call，现在改名为 tool_choice，是指选择的工具，有以下 3 种值：<ul>
<li>auto：根据用户问题选择工具，是默认值</li>
<li>none：不选择任何工具，直接返回生成的消息</li>
<li>工具名称：选择某个工具，比如：<code>&#123;&quot;type: &quot;function&quot;, &quot;function&quot;: &#123;&quot;name&quot;: &quot;get_current_weather&quot;&#125;&#125;</code></li>
</ul>
</li>
</ul>
<p>这样在调用对话 API 后，ChatGPT 会根据用户的问题返回需要用到的工具列表 tool_calls，这个列表包含了每个工具的名称和参数等信息，下面继续看如何调用工具：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">response_message = response.choices[<span class="number">0</span>].message</span><br><span class="line">tool_calls = response_message.tool_calls</span><br><span class="line"><span class="keyword">if</span> tool_calls:</span><br><span class="line">    messages.append(response_message)</span><br><span class="line">    available_functions = &#123;</span><br><span class="line">        <span class="string">&quot;get_current_weather&quot;</span>: get_current_weather,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> tool_call <span class="keyword">in</span> tool_calls:</span><br><span class="line">        function_name = tool_call.function.name</span><br><span class="line">        function_to_call = available_functions[function_name]</span><br><span class="line">        function_args = json.loads(tool_call.function.arguments)</span><br><span class="line">        function_response = function_to_call(</span><br><span class="line">            location=function_args.get(<span class="string">&quot;location&quot;</span>),</span><br><span class="line">        )</span><br><span class="line">        messages.append(</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;tool_call_id&quot;</span>: tool_call.<span class="built_in">id</span>,</span><br><span class="line">                <span class="string">&quot;role&quot;</span>: <span class="string">&quot;tool&quot;</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: function_name,</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: function_response,</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    second_response = client.chat.completions.create(</span><br><span class="line">        model=<span class="string">&quot;gpt-3.5-turbo-1106&quot;</span>,</span><br><span class="line">        messages=messages,</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(second_response.choices[<span class="number">0</span>].message.content)</span><br></pre></td></tr></table></figure>

<ul>
<li>得到工具列表后，我们就可以根据工具列表来调用工具了，这里我们定义了一个<code>get_current_weather</code>的方法，然后根据工具列表中的工具名和参数来调用这个方法。</li>
<li>将方法返回的结果，结合工具调用 id 和工具名等信息，以 tool 为角色添加 message 信息到到历史对话中。</li>
<li>得到最后的历史对话 messages 后，再次调用对话 API，由 ChatGPT 根据工具的返回结果来生成最终的答案，注意这里的 model 参数也是需要选择新模型。</li>
</ul>
<p>我们为了演示方便，<code>get_current_weather</code>方法使用一些简单的逻辑来模拟天气查询的功能：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_weather</span>(<span class="params">location</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Get the current weather in a given location&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;北京&quot;</span> <span class="keyword">in</span> location.lower():</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&quot;location&quot;</span>: location, <span class="string">&quot;temperature&quot;</span>: <span class="string">&quot;10°&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&quot;上海&quot;</span> <span class="keyword">in</span> location.lower():</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&quot;location&quot;</span>: location, <span class="string">&quot;temperature&quot;</span>: <span class="string">&quot;15°&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&quot;location&quot;</span>: location, <span class="string">&quot;temperature&quot;</span>: <span class="string">&quot;20°&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>最终的返回结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">北京目前温度为10℃，上海为15℃，成都为20℃。</span><br></pre></td></tr></table></figure>

<p>最终完整的对话记录如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span> <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;今天北京、上海、成都的天气怎么样？&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assistant&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tool_calls&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;call_hrGSR6rUAiTjdqi5BDNY3DCr&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;function&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;function&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;\&quot;location\&quot;: \&quot;北京\&quot;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;get_current_weather&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;call_L8cyPoBWcfAU6Q8dyZP8mA5k&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;function&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;function&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;\&quot;location\&quot;: \&quot;上海\&quot;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;get_current_weather&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;call_RZvc1iGHJ0BnJwuqYmSeo5YF&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;function&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;function&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;\&quot;location\&quot;: \&quot;成都\&quot;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;get_current_weather&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tool&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tool_call_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;call_hrGSR6rUAiTjdqi5BDNY3DCr&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;get_current_weather&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;\&quot;location\&quot;: \&quot;北京\&quot;, \&quot;temperature\&quot;: \&quot;10°\&quot;&#125;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tool&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tool_call_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;call_L8cyPoBWcfAU6Q8dyZP8mA5k&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;get_current_weather&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;\&quot;location\&quot;: \&quot;上海\&quot;, \&quot;temperature\&quot;: \&quot;15°\&quot;&#125;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tool&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tool_call_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;call_RZvc1iGHJ0BnJwuqYmSeo5YF&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;get_current_weather&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;\&quot;location\&quot;: \&quot;成都\&quot;, \&quot;temperature\&quot;: \&quot;20°\&quot;&#125;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assistant&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北京目前温度为10℃，上海为15℃，成都为20℃。&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h2 id="图像识别"><a href="#图像识别" class="headerlink" title="图像识别"></a>图像识别</h2><p>GPT4V 可以用来识别用户上传的图片内容，更多的介绍可以参考我之前的<a href="https://zhaozhiming.github.io/2023/10/15/interesting-gpt4v/">这篇文章</a>，以前只能在 Web 或 APP 中使用，现在也终于开放了 API。以下是使用方法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">client = OpenAI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_image</span>(<span class="params">image_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(image_path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> image_file:</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(image_file.read()).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">base_image = encode_image(<span class="string">&quot;output.png&quot;</span>)</span><br><span class="line">completion = client.chat.completions.create(</span><br><span class="line">    model=<span class="string">&quot;gpt-4-vision-preview&quot;</span>,</span><br><span class="line">    messages=[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">                &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;图片中是什么内容&quot;</span>&#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image_url&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;image_url&quot;</span>: &#123;</span><br><span class="line">                        <span class="comment"># 可以是图片的 base64 编码</span></span><br><span class="line">                        <span class="string">&quot;url&quot;</span>: <span class="string">f&quot;data:image/png;base64, <span class="subst">&#123;base_image&#125;</span>&quot;</span>,</span><br><span class="line">                        <span class="comment"># # 也可以是图片的 url 地址</span></span><br><span class="line">                        <span class="comment"># &quot;url&quot;: &quot;https://image-server.com/foo.png&quot;,</span></span><br><span class="line">                        <span class="string">&quot;detail&quot;</span>: <span class="string">&quot;high&quot;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    max_tokens=<span class="number">300</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(completion.choices[<span class="number">0</span>].message.content)</span><br></pre></td></tr></table></figure>

<ul>
<li>model 参数是指使用的模型，图片识别的功能只能使用 gpt-4-vision-preview 这个模型。</li>
<li>user 的提示词不再是字符串类型，而是一个数组类型，数组中包含了文字和图片信息，文字信息是用户的问题，图片信息是用户上传的图片文件。</li>
<li>上传的图片可以是图片文件的 Base64 编码，示例代码中我们用一个 Python 方法将图片转成 Base64 编码。同时也支持图片的 url 地址，官方建议使用 url 地址来做图片识别，因为使用图片 base64 编码的话，OpenAI API 接收到请求后还需要下载图片，从而增加了 API 的调用时间。</li>
<li>image_url 参数中的 detail 参数用来控制模型识别图片的精准度，有 low 和 high 两个选项，low 对图片识别较快但识别度不高，high 对图片识别较准确，但所耗费的 token 也较多。</li>
</ul>
<p>在图片识别 API 中，可以同时上传多个图片，下面是一个比较两张图片的代码示例（但经过实际测试，GPT4V 对图片的比较还存在较大的误差，讲出来的不同点根本不是图片中的内容）：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">completion = client.chat.completions.create(</span><br><span class="line">    model=<span class="string">&quot;gpt-4-vision-preview&quot;</span>,</span><br><span class="line">    messages=[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">                &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;比较这两张图片有什么不同&quot;</span>&#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image_url&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;image_url&quot;</span>: &#123; <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://image-server.com/diff1.png&quot;</span> &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image_url&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;image_url&quot;</span>: &#123; <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://image-server.com/diff2.png&quot;</span> &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    max_tokens=<span class="number">300</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>在 content 数组中添加多个 image_url 参数即表示多个图片，但经过实际测试，GPT4V 对图片的比较还存在较大的误差，讲出来的不同点跟图片中的内容不符。上传的图片在调用完 API 后会被 OpenAI 服务器自动删除，所以不用担心会被拿去训练他们的模型。</p>
<h3 id="GPT4V-的限制"><a href="#GPT4V-的限制" class="headerlink" title="GPT4V 的限制"></a>GPT4V 的限制</h3><p>目前 GPT4V 对图片识别存在以下限制：</p>
<ul>
<li>医学图片：该模型不适合解释像 CT 图片等医学图片</li>
<li>非英文图片：目前对非英文的图片识别不好</li>
<li>旋转图片：对旋转的图片或文字识别不好</li>
<li>验证码：不要想利用 GPT4V 来识别验证码了，OpenAI 已经禁止了这个功能</li>
</ul>
<p>更多的限制信息请看<a target="_blank" rel="noopener" href="https://platform.openai.com/docs/guides/vision/limitations">这里</a>。</p>
<h3 id="图片识别的-token-计算"><a href="#图片识别的-token-计算" class="headerlink" title="图片识别的 token 计算"></a>图片识别的 token 计算</h3><p>因为图片识别 API 需要上传图片，所以在计算 API 耗费的 token 时需要考虑图片的大小，当识别图片使用的是<code>detail: low</code>的低保真模式时，每张图片耗费 85 token；而使用<code>detail: high</code>的高保真模式时，每张图片按照包含多少个 512 平方来计算 token，每包含 1 个 512 平方耗费 170 token，最后再加上固定的 85 token，比如一张 1024 x 1024 的图片，包含了 4 个 512 平方，所以 就会耗费 680 token，最后再加上 85 token，所以总共耗费 765 token。</p>
<p>具体的 token 计算规则可参考官方的<a target="_blank" rel="noopener" href="https://platform.openai.com/docs/guides/vision/calculating-costs">消费计算规则</a>。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文介绍了 OpenAI 新版 API 中的文字转语音、图像生成、图像识别等功能，这些新版的 API 可以帮助我们构建功能更加强大的 AI 应用，而且 OpenAI 还开放了 GPTs 的 API 功能——Assistant API，我们将在下期对这个新 API 进行详细介绍，敬请期待。</p>
<p>关注我，一起学习各种人工智能和 AIGC 新技术，欢迎交流，如果你有什么想问想说的，欢迎在评论区留言。</p>
</div>

</article>
<section id="appreciates">
  <center>
	<h2>赞赏</h2>
    <div class="post-footer">
      <div>
	    <h4>如果文章对您有所帮助，可以捐赠我喝杯咖啡😌，捐赠方式：</h4>
        <div class="digital-wallet">
          <h6>BTC 地址：3LYgSyf7ddMALwGWPQr3PY4wzjsTDdg1oV</h6>
          <h6>ETH 地址：0x0C9b27c89A61aadb0aEC24CA8949910Cbf77Aa73</h6>
        </div>
        <div class="wechat_appreciates">
          <img src="/images/wechat_appreciates.png" alt="qrcode" width="250" >
        </div>
      </div>
      <div>
	    <h4>文章已同步更新公众号，欢迎关注</h4>
        <div class="wechat_appreciates">
          <img src="/images/wxgzh_qrcode.jpg" alt="qrcode" width="250" >
        </div>
      </div>
    </div>
  </center>
</section>



    
      <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = 'https://zhaozhiming.github.io/2023/11/11/openai-new-api-introduct/';
            this.page.identifier = 'https://zhaozhiming.github.io/2023/11/11/openai-new-api-introduct/';
        };

        (function() {
          var d = document, s = d.createElement('script');
          s.src = '//zhaozhiming.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

</div>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2025

    赵芝明
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a target="_blank" rel="noopener" href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a target="_blank" rel="noopener" href="http://github.com/panks/fabric">fabric</a> by <a target="_blank" rel="noopener" href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5608723650603289" crossorigin="anonymous"></script>
</body>
</html>
